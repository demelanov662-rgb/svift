<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-title" content="Svift">
    <link rel="manifest" href="/manifest.json">
    <title>Svift</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-text-size-adjust: 100%;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #0f0f0f;
            -webkit-overflow-scrolling: touch;
            touch-action: manipulation;
        }
        
        body {
            background: #0f0f0f;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 0;
            touch-action: manipulation;
            overscroll-behavior: none;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            height: -webkit-fill-available;
            max-width: 500px;
            max-height: 900px;
            border-radius: 0;
            overflow: hidden;
            margin: 0 auto;
            box-shadow: none;
            position: relative;
            background: #1a1a1a;
            border: none;
        }
        
        @media (min-width: 768px) {
            .container {
                width: 375px;
                height: 667px;
                border-radius: 16px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                border: 1px solid #2a2a2a;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            
            body {
                padding: 20px;
            }
        }
        
        /* Prevent zoom on input focus on mobile */
        @media screen and (max-width: 767px) {
            input, textarea, select {
                font-size: 16px !important;
            }
            
            textarea {
                max-height: 100px !important;
            }
        }
        
        /* –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ */
        #registrationScreen {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            padding: 40px 20px;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }
        
        .registration-logo {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .registration-logo h1 {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .registration-logo p {
            color: #8e8e93;
            font-size: 16px;
        }
        
        .registration-form {
            width: 100%;
            max-width: 320px;
        }
        
        .registration-title {
            color: #ffffff;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .registration-subtitle {
            color: #8e8e93;
            font-size: 15px;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.4;
        }
        
        .phone-input-container {
            margin-bottom: 20px;
        }
        
        .phone-input-label {
            display: block;
            color: #8e8e93;
            font-size: 14px;
            margin-bottom: 8px;
            margin-left: 4px;
        }
        
        .phone-input-wrapper {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        
        .country-code {
            padding: 16px;
            color: #ffffff;
            font-weight: 600;
            border-right: 1px solid #3a3a3a;
            background: #2a2a2a;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .phone-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: #ffffff;
            font-size: 16px;
            padding: 16px;
            width: 100%;
        }
        
        .phone-input::placeholder {
            color: #8e8e93;
        }
        
        .registration-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            -webkit-tap-highlight-color: rgba(0, 122, 255, 0.3);
        }
        
        .registration-button:hover {
            opacity: 0.9;
        }
        
        .registration-button:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .registration-button:disabled {
            background: #2a2a2a;
            color: #8e8e93;
            cursor: not-allowed;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ —á–∞—Ç–æ–≤ */
        #chatsScreen {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            display: none;
        }
        
        .header {
            background: #1a1a1a;
            color: #ffffff;
            padding: 12px 16px;
            border-bottom: 1px solid #2a2a2a;
            flex-shrink: 0;
            position: relative;
            padding-top: max(12px, env(safe-area-inset-top));
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .header h1 {
            font-size: 22px;
            font-weight: 700;
            flex: 1;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .icon-button {
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 22px;
            cursor: pointer;
            padding: 6px;
            border-radius: 50%;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            opacity: 0.8;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
        }
        
        .icon-button:active {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(0.95);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-button {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            position: relative;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }
        
        .profile-button:active .profile-avatar {
            transform: scale(0.95);
        }
        
        .search-container {
            background: #2a2a2a;
            margin: 0;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            padding: 0 12px;
            height: 44px;
        }
        
        .search-input-container {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .search-input-container .icon {
            color: #8e8e93;
            margin-right: 8px;
            font-size: 18px;
        }
        
        .search-input-container input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 16px;
            flex: 1;
            background: transparent;
            color: #ffffff;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .search-input-container input::placeholder {
            color: #8e8e93;
        }
        
        .chat-list {
            overflow-y: auto;
            flex: 1;
            background: #1a1a1a;
            -webkit-overflow-scrolling: touch;
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }
        
        .chat-item {
            display: flex;
            padding: 14px 16px;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
            border-bottom: 1px solid #2a2a2a;
            min-height: 70px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.05);
        }
        
        .chat-item:active {
            background: #333333;
        }
        
        .avatar {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 600;
            margin-right: 14px;
            flex-shrink: 0;
            position: relative;
        }
        
        .avatar.online::after {
            content: '';
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 12px;
            height: 12px;
            background: #4cd964;
            border-radius: 50%;
            border: 2px solid #1a1a1a;
        }
        
        .avatar.muted::before {
            content: 'üîá';
            position: absolute;
            bottom: -2px;
            right: -2px;
            font-size: 16px;
            background: #1a1a1a;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-info {
            flex: 1;
            min-width: 0;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .chat-name {
            font-weight: 600;
            font-size: 17px;
            color: #ffffff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-username {
            color: #8e8e93;
            font-size: 14px;
            margin-left: 6px;
        }
        
        .chat-time {
            color: #8e8e93;
            font-size: 14px;
            font-weight: 400;
        }
        
        .last-message {
            color: #8e8e93;
            font-size: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .last-message.unread {
            color: #ffffff;
            font-weight: 500;
        }
        
        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
            flex-shrink: 0;
            margin-left: 8px;
        }
        
        .unread-badge {
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            border-radius: 18px;
            min-width: 24px;
            height: 24px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 8px;
        }
        
        .pinned-indicator {
            color: #8e8e93;
            font-size: 20px;
            opacity: 0.7;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –¥–∏–∞–ª–æ–≥–∞ */
        #chatScreen {
            height: 100%;
            display: flex;
            flex-direction: column;
            display: none;
            background: #1a1a1a;
        }
        
        .chat-header-bar {
            background: #1a1a1a;
            color: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
            border-bottom: 1px solid #2a2a2a;
            padding-top: max(12px, env(safe-area-inset-top));
        }
        
        .back-button {
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
        }
        
        .back-button:active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .chat-header-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            flex-shrink: 0;
            position: relative;
        }
        
        .chat-header-info {
            flex: 1;
        }
        
        .chat-header-info h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 2px;
            color: #ffffff;
        }
        
        .chat-header-info .username {
            font-size: 15px;
            color: #8e8e93;
            margin-bottom: 2px;
        }
        
        .chat-header-info .status {
            font-size: 15px;
            color: #8e8e93;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(5px);
        }
        
        .profile-modal {
            background: #2a2a2a;
            width: 300px;
            height: 100%;
            transform: translateX(100%);
            animation: slideIn 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.3) forwards;
            display: flex;
            flex-direction: column;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        .profile-modal-header {
            background: #2a2a2a;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 1px solid #3a3a3a;
            position: relative;
        }
        
        .profile-modal-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: 600;
            margin-bottom: 14px;
            border: 4px solid #3a3a3a;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .profile-modal-avatar:active {
            border-color: #007aff;
            transform: scale(0.95);
        }
        
        .profile-modal-name {
            font-size: 22px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        
        .profile-modal-name:active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .profile-modal-username {
            font-size: 17px;
            color: #00d4ff;
            margin-bottom: 10px;
            background: rgba(0, 212, 255, 0.1);
            padding: 6px 14px;
            border-radius: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .profile-modal-username:active {
            background: rgba(0, 212, 255, 0.2);
        }
        
        .profile-modal-phone {
            font-size: 16px;
            color: #8e8e93;
        }
        
        .profile-modal-menu {
            flex: 1;
            padding: 16px 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            max-height: calc(100vh - 300px);
        }
        
        .profile-menu-item {
            display: flex;
            align-items: center;
            padding: 18px 24px;
            color: #ffffff;
            text-decoration: none;
            transition: background-color 0.2s;
            cursor: pointer;
            border-bottom: 1px solid #3a3a3a;
            touch-action: manipulation;
            min-height: 60px;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
        }
        
        .profile-menu-item:active {
            background: #404040;
        }
        
        .profile-menu-icon {
            font-size: 24px;
            margin-right: 18px;
            width: 28px;
            text-align: center;
            opacity: 0.8;
        }
        
        .profile-menu-text {
            font-size: 17px;
            flex: 1;
        }
        
        .profile-menu-arrow {
            font-size: 20px;
            color: #8e8e93;
            opacity: 0.6;
        }
        
        .profile-modal-footer {
            padding: 20px;
            border-top: 1px solid #3a3a3a;
        }
        
        .profile-logout-button {
            width: 100%;
            padding: 16px;
            background: rgba(255, 69, 58, 0.1);
            color: #ff453a;
            border: 1px solid rgba(255, 69, 58, 0.2);
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(255, 69, 58, 0.2);
        }
        
        .profile-logout-button:active {
            background: rgba(255, 69, 58, 0.2);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è */
        .edit-profile-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            display: none;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .edit-profile-modal {
            background: #2a2a2a;
            border-radius: 16px;
            width: 100%;
            max-width: 340px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.3);
            display: flex;
            flex-direction: column;
        }
        
        .edit-profile-modal-header {
            background: #2a2a2a;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #3a3a3a;
            flex-shrink: 0;
        }
        
        .edit-profile-modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .edit-profile-modal-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #8e8e93;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .edit-profile-modal-close:active {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .edit-profile-modal-content {
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }
        
        .avatar-edit-container {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .avatar-edit-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: 600;
            margin-bottom: 20px;
            border: 4px solid #3a3a3a;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .avatar-edit-preview:active {
            border-color: #007aff;
            transform: scale(0.95);
        }
        
        .change-avatar-button {
            background: #3a3a3a;
            color: #ffffff;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            touch-action: manipulation;
            width: 100%;
            margin-top: 10px;
        }
        
        .change-avatar-button:active {
            background: #4a4a4a;
        }
        
        .profile-edit-input {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            color: #ffffff;
            width: 100%;
            margin-bottom: 20px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            transition: border-color 0.2s;
        }
        
        .profile-edit-input:focus {
            border-color: #007aff;
            background: #3a3a3a;
        }
        
        .profile-edit-label {
            display: block;
            color: #ffffff;
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 10px;
            margin-left: 4px;
        }
        
        .avatar-colors {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .avatar-color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            touch-action: manipulation;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .avatar-color-option:active {
            transform: scale(0.95);
        }
        
        .avatar-color-option.selected {
            border-color: #007aff;
            box-shadow: 0 0 0 2px #007aff;
        }
        
        .save-profile-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            touch-action: manipulation;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }
        
        .save-profile-button:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            display: none;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .settings-modal {
            background: #2a2a2a;
            border-radius: 16px;
            width: 100%;
            max-width: 340px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.3);
            display: flex;
            flex-direction: column;
        }
        
        .settings-modal-header {
            background: #2a2a2a;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #3a3a3a;
            flex-shrink: 0;
        }
        
        .settings-modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .settings-modal-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #8e8e93;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .settings-modal-close:active {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .settings-modal-content {
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }
        
        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        
        .settings-option:last-child {
            border-bottom: none;
        }
        
        .settings-option-label {
            font-size: 16px;
            color: #ffffff;
            flex: 1;
        }
        
        .settings-option-value {
            font-size: 16px;
            color: #8e8e93;
            margin-right: 10px;
        }
        
        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 30px;
        }
        
        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .settings-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a4a4a;
            transition: .4s;
            border-radius: 34px;
        }
        
        .settings-toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .settings-toggle input:checked + .settings-toggle-slider {
            background-color: #007aff;
        }
        
        .settings-toggle input:checked + .settings-toggle-slider:before {
            transform: translateX(20px);
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            -webkit-overflow-scrolling: touch;
            padding-bottom: max(80px, env(safe-area-inset-bottom));
        }
        
        .message-date {
            text-align: center;
            margin: 16px 0;
            position: relative;
        }
        
        .message-date span {
            background: rgba(142, 142, 147, 0.2);
            color: #8e8e93;
            padding: 6px 14px;
            border-radius: 18px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
            animation: fadeIn 0.3s ease-out;
        }
        
        .message.incoming {
            align-self: flex-start;
            background: #2a2a2a;
            color: #ffffff;
            border-bottom-left-radius: 6px;
        }
        
        .message.outgoing {
            align-self: flex-end;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }
        
        .message-text {
            font-size: 16px;
            margin-bottom: 6px;
        }
        
        .message-sender {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #00d4ff;
        }
        
        .message-meta {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            opacity: 0.8;
        }
        
        .message-time {
            font-size: 13px;
            opacity: 0.8;
        }
        
        .message-status {
            font-size: 14px;
            color: #8e8e93;
        }
        
        .message-status.read {
            color: #34c759;
        }
        
        .input-container {
            padding: 12px 16px;
            background: #1a1a1a;
            border-top: 1px solid #2a2a2a;
            display: flex;
            gap: 12px;
            align-items: flex-end;
            flex-shrink: 0;
            position: relative;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
        }
        
        .message-input-wrapper {
            flex: 1;
            background: #2a2a2a;
            border-radius: 24px;
            display: flex;
            align-items: center;
            padding: 10px 16px;
            min-height: 48px;
        }
        
        .message-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 16px;
            color: #ffffff;
            resize: none;
            max-height: 120px;
            min-height: 28px;
            font-family: inherit;
            line-height: 1.4;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .message-input::placeholder {
            color: #8e8e93;
        }
        
        .input-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: 8px;
        }
        
        .input-button {
            background: transparent;
            border: none;
            color: #8e8e93;
            font-size: 22px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .input-button:active {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .send-button {
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            transition: all 0.2s;
            flex-shrink: 0;
            touch-action: manipulation;
        }
        
        .send-button:active {
            opacity: 0.8;
            transform: scale(0.95);
        }
        
        .send-button:disabled {
            background: #2a2a2a;
            color: #8e8e93;
            cursor: not-allowed;
        }
        
        .floating-button {
            position: absolute;
            bottom: max(20px, env(safe-area-inset-bottom));
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.3);
            border: none;
            transition: all 0.2s;
            z-index: 50;
            touch-action: manipulation;
        }
        
        .floating-button:active {
            opacity: 0.8;
            transform: scale(0.95);
            box-shadow: 0 6px 25px rgba(0, 122, 255, 0.4);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* –°–µ–∫—Ü–∏—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ */
        .pinned-section {
            border-bottom: 1px solid #2a2a2a;
        }
        
        .section-title {
            color: #8e8e93;
            font-size: 14px;
            font-weight: 500;
            padding: 10px 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* –ê–≤–∞—Ç–∞—Ä —Å –∏–∫–æ–Ω–∫–æ–π –≥—Ä—É–ø–ø—ã */
        .avatar.group::before {
            content: 'üë•';
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: #1a1a1a;
            border-radius: 50%;
            padding: 3px;
            font-size: 14px;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
        .chat-item, .message, .profile-menu-item {
            user-select: none;
            -webkit-user-select: none;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            z-index: 1000;
            animation: fadeInOut 3s ease-in-out;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 90%;
            text-align: center;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è Svift Premium */
        .premium-menu-item {
            position: relative;
            overflow: hidden;
        }

        .premium-menu-item .premium-badge {
            position: absolute;
            top: 8px;
            right: 24px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            font-size: 11px;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: premiumGlow 2s ease-in-out infinite;
        }

        @keyframes premiumGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); }
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Svift Premium */
        .premium-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            display: none;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .premium-modal {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-radius: 24px;
            width: 100%;
            max-width: 360px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(255, 215, 0, 0.2);
            animation: premiumModalSlideIn 0.5s cubic-bezier(0.2, 0.9, 0.3, 1.3);
            display: flex;
            flex-direction: column;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        @keyframes premiumModalSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .premium-modal-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.1) 100%);
            padding: 30px 20px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .premium-modal-header h3 {
            margin: 0;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .premium-subtitle {
            color: #FFD700;
            font-size: 16px;
            opacity: 0.9;
        }

        .premium-modal-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 215, 0, 0.1);
            border: none;
            color: #FFD700;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .premium-modal-close:active {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-50%) scale(0.95);
        }

        .premium-modal-content {
            padding: 30px 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }

        .premium-feature {
            display: flex;
            align-items: flex-start;
            padding: 18px 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .premium-feature:last-child {
            border-bottom: none;
        }

        .premium-feature-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 20px;
            font-weight: bold;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .premium-feature-content {
            flex: 1;
        }

        .premium-feature-title {
            color: #FFD700;
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .premium-feature-description {
            color: #ffffff;
            font-size: 15px;
            line-height: 1.4;
            opacity: 0.9;
        }

        .premium-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .premium-button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .premium-button:active {
            transform: scale(0.98);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.6);
        }

        .premium-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .premium-price {
            color: #FFD700;
            font-size: 14px;
            margin-top: 12px;
            opacity: 0.9;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∑–Ω–∞—á–∫–∞ Premium */
        .premium-avatar {
            position: relative;
        }

        .premium-avatar::after {
            content: '‚≠ê';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #1a1a1a;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid #FFD700;
            animation: starPulse 1.5s ease-in-out infinite;
        }

        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞/–∫–∞–Ω–∞–ª–∞ */
        .create-channel-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 6000;
            display: none;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .create-channel-modal {
            background: #2a2a2a;
            border-radius: 20px;
            width: 100%;
            max-width: 340px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.3);
            display: flex;
            flex-direction: column;
        }
        
        .create-channel-header {
            background: #2a2a2a;
            color: white;
            padding: 24px 20px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #3a3a3a;
            flex-shrink: 0;
        }
        
        .create-channel-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        .create-channel-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #8e8e93;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .create-channel-close:active {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .create-channel-content {
            padding: 24px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }
        
        .channel-step {
            display: none;
        }
        
        .channel-step.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        .channel-step-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .channel-step-description {
            font-size: 15px;
            color: #8e8e93;
            margin-bottom: 24px;
            text-align: center;
            line-height: 1.4;
        }
        
        .channel-type-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .channel-type-option {
            background: #3a3a3a;
            border: 2px solid #4a4a4a;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .channel-type-option:hover {
            background: #404040;
        }
        
        .channel-type-option.selected {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.1);
        }
        
        .channel-type-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
        }
        
        .channel-type-info {
            flex: 1;
        }
        
        .channel-type-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }
        
        .channel-type-description {
            font-size: 14px;
            color: #8e8e93;
            line-height: 1.4;
        }
        
        .privacy-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .privacy-option {
            background: #3a3a3a;
            border: 2px solid #4a4a4a;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .privacy-option:hover {
            background: #404040;
        }
        
        .privacy-option.selected {
            border-color: #007aff;
            background: rgba(0, 122, 255, 0.1);
        }
        
        .privacy-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: #4a4a4a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #ffffff;
            flex-shrink: 0;
        }
        
        .privacy-info {
            flex: 1;
        }
        
        .privacy-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }
        
        .privacy-description {
            font-size: 14px;
            color: #8e8e93;
            line-height: 1.4;
        }
        
        .channel-input-container {
            margin-bottom: 24px;
        }
        
        .channel-input-label {
            display: block;
            color: #8e8e93;
            font-size: 14px;
            margin-bottom: 8px;
            margin-left: 4px;
        }
        
        .channel-input-wrapper {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        
        .channel-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: #ffffff;
            font-size: 16px;
            padding: 16px;
            width: 100%;
        }
        
        .channel-input::placeholder {
            color: #8e8e93;
        }
        
        .channel-link-prefix {
            padding: 16px;
            color: #8e8e93;
            font-weight: 500;
            border-right: 1px solid #4a4a4a;
            background: #3a3a3a;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .create-channel-footer {
            padding: 20px;
            border-top: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }
        
        .channel-button {
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            touch-action: manipulation;
            flex: 1;
            border: none;
        }
        
        .channel-button.back {
            background: #3a3a3a;
            color: #ffffff;
        }
        
        .channel-button.back:active {
            background: #4a4a4a;
        }
        
        .channel-button.next {
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
        }
        
        .channel-button.next:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .channel-button.create {
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            color: white;
        }
        
        .channel-button.create:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        .channel-button:disabled {
            background: #2a2a2a;
            color: #8e8e93;
            cursor: not-allowed;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É */
        .search-users-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 7000;
            display: none;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .search-users-modal {
            background: #2a2a2a;
            border-radius: 20px;
            width: 100%;
            max-width: 360px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s cubic-bezier(0.2, 0.9, 0.3, 1.3);
            display: flex;
            flex-direction: column;
        }
        
        .search-users-header {
            background: #2a2a2a;
            color: white;
            padding: 24px 20px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #3a3a3a;
            flex-shrink: 0;
        }
        
        .search-users-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        .search-users-close {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #8e8e93;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            touch-action: manipulation;
        }
        
        .search-users-close:active {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .search-users-content {
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }
        
        .search-users-input-container {
            margin-bottom: 20px;
        }
        
        .search-users-input-wrapper {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        
        .search-users-input-wrapper .icon {
            padding: 16px;
            color: #8e8e93;
            font-size: 18px;
        }
        
        .search-users-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: #ffffff;
            font-size: 16px;
            padding: 16px 16px 16px 0;
            width: 100%;
        }
        
        .search-users-input::placeholder {
            color: #8e8e93;
        }
        
        .search-users-results {
            max-height: 300px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .search-user-item {
            display: flex;
            padding: 16px;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 12px;
            margin-bottom: 8px;
        }
        
        .search-user-item:active {
            background: #404040;
        }
        
        .search-user-item:hover {
            background: #333333;
        }
        
        .search-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            margin-right: 14px;
            flex-shrink: 0;
        }
        
        .search-user-info {
            flex: 1;
        }
        
        .search-user-name {
            font-weight: 600;
            font-size: 16px;
            color: #ffffff;
            margin-bottom: 4px;
        }
        
        .search-user-username {
            color: #8e8e93;
            font-size: 14px;
        }
        
        .search-user-status {
            color: #8e8e93;
            font-size: 13px;
            margin-top: 2px;
        }
        
        .search-user-status.online {
            color: #4cd964;
        }
        
        .search-user-start-chat {
            background: linear-gradient(135deg, #007aff 0%, #00d4ff 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .search-user-start-chat:active {
            opacity: 0.8;
            transform: scale(0.95);
        }
        
        .no-users-found {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }
        
        .no-users-found-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }
        
        .no-users-found-text {
            font-size: 16px;
        }
        
        .search-users-loading {
            text-align: center;
            padding: 40px 20px;
            color: #8e8e93;
        }
        
        .search-users-loading-icon {
            font-size: 32px;
            margin-bottom: 16px;
            display: block;
            animation: rotate 1s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .search-users-error {
            text-align: center;
            padding: 40px 20px;
            color: #ff453a;
        }
        
        .search-users-error-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }
        
        .search-users-error-text {
            font-size: 16px;
        }
        
        .search-users-history {
            margin-top: 20px;
        }
        
        .search-history-title {
            color: #8e8e93;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .search-history-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #3a3a3a;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .search-history-item:active {
            background: #404040;
        }
        
        .search-history-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .search-history-info {
            flex: 1;
        }
        
        .search-history-name {
            font-size: 15px;
            color: #ffffff;
            margin-bottom: 2px;
        }
        
        .search-history-username {
            font-size: 13px;
            color: #8e8e93;
        }
        
        .search-history-time {
            font-size: 12px;
            color: #8e8e93;
            margin-top: 2px;
        }
        
        .search-history-clear {
            background: transparent;
            border: 1px solid #4a4a4a;
            color: #8e8e93;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
        }
        
        .search-history-clear:active {
            background: #4a4a4a;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .user-id-display {
            color: #8e8e93;
            font-size: 13px;
            margin-top: 4px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
            font-family: monospace;
        }
        
        .profile-modal-id {
            font-size: 14px;
            color: #8e8e93;
            margin-top: 6px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
            font-family: monospace;
        }
        
        .search-user-id {
            font-size: 12px;
            color: #8e8e93;
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            font-family: monospace;
            margin-top: 2px;
        }
        
        .chat-id-display {
            font-size: 12px;
            color: #8e8e93;
            margin-top: 2px;
            font-family: monospace;
        }
        
        /* Mobile-specific fixes */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
            }
            
            .profile-modal {
                width: 280px;
            }
            
            .floating-button {
                width: 56px;
                height: 56px;
                font-size: 24px;
                bottom: max(16px, env(safe-area-inset-bottom));
                right: 16px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .chat-header-avatar {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .avatar {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }
            
            .registration-logo h1 {
                font-size: 42px;
            }
            
            .registration-form {
                padding: 0 10px;
            }
        }
        
        /* iPhone notch support */
        @supports (padding: max(0px)) {
            .header, .chat-header-bar {
                padding-top: max(12px, env(safe-area-inset-top));
            }
            
            .chat-list, .messages-container {
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
            
            .input-container {
                padding-bottom: max(12px, env(safe-area-inset-bottom));
            }
            
            .floating-button {
                bottom: max(20px, env(safe-area-inset-bottom));
            }
        }
        
        /* Prevent pull-to-refresh on mobile */
        body {
            overscroll-behavior-y: none;
        }
        
        /* Better scrollbars for mobile */
        .chat-list::-webkit-scrollbar,
        .messages-container::-webkit-scrollbar,
        .profile-modal-menu::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-list::-webkit-scrollbar-track,
        .messages-container::-webkit-scrollbar-track,
        .profile-modal-menu::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-list::-webkit-scrollbar-thumb,
        .messages-container::-webkit-scrollbar-thumb,
        .profile-modal-menu::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container" id="appContainer">
        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
        <div id="registrationScreen">
            <div class="registration-logo">
                <h1>Svift</h1>
                <p id="registrationSubtitle">–ë—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</p>
            </div>
            
            <div class="registration-form">
                <h2 class="registration-title" id="registrationTitle">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä</h2>
                <p class="registration-subtitle" id="registrationSubtitleText">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ Svift</p>
                
                <div class="phone-input-container">
                    <label class="phone-input-label" id="phoneInputLabel">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <div class="phone-input-wrapper">
                        <div class="country-code">
                            <span>üá∑üá∫</span>
                            <span>+7</span>
                        </div>
                        <input 
                            type="tel" 
                            class="phone-input" 
                            id="phoneInput" 
                            placeholder="7777777777"
                            inputmode="numeric"
                            autocomplete="tel"
                        >
                    </div>
                </div>
                
                <button class="registration-button" id="continueButton">
                    <span id="continueButtonText">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
                </button>
                
                <p class="registration-subtitle" style="font-size: 13px; margin-top: 20px;">
                    <span id="termsText">–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ</span> 
                    <a href="#" style="color: #007aff;" id="termsLink">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                </p>
            </div>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ -->
        <div id="chatsScreen">
            <div class="header">
                <div class="header-top">
                    <h1>Svift</h1>
                    <div class="header-buttons">
                        <button class="icon-button" id="searchUsernameButton" title="–ü–æ–∏—Å–∫ –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É">
                            <span class="icon">@</span>
                        </button>
                        <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                        <button class="profile-button" id="profileButton" title="–ü—Ä–æ—Ñ–∏–ª—å">
                            <div class="profile-avatar" id="userAvatar">
                                –ù
                            </div>
                        </button>
                    </div>
                </div>
                
                <div class="search-container">
                    <div class="search-input-container">
                        <span class="icon">üîç</span>
                        <input type="text" placeholder="–ü–æ–∏—Å–∫" id="searchInput" autocomplete="off">
                    </div>
                </div>
            </div>
            
            <div class="chat-list" id="chatList">
                <!-- –°–µ–∫—Ü–∏—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ -->
                <div class="pinned-section">
                    <div class="section-title" id="pinnedChatsTitle">–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ</div>
                    <!-- –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —á–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div class="section-title" id="allChatsTitle">–í—Å–µ —á–∞—Ç—ã</div>
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —á–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
            
            <button class="floating-button" id="newChatButton" title="–ù–æ–≤—ã–π —á–∞—Ç">
                <span class="icon">‚úèÔ∏è</span>
            </button>
        </div>
        
        <!-- –≠–∫—Ä–∞–Ω –¥–∏–∞–ª–æ–≥–∞ -->
        <div id="chatScreen">
            <div class="chat-header-bar">
                <button class="back-button" id="backButton">
                    <span class="icon">‚Üê</span>
                </button>
                
                <div class="chat-header-avatar" id="currentChatAvatar">
                    <!-- –ê–≤–∞—Ç–∞—Ä –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div class="chat-header-info">
                    <h2 id="currentChatName">–ò–º—è —á–∞—Ç–∞</h2>
                    <div class="username" id="currentChatUsername"></div>
                    <div class="status" id="currentChatStatus">–±—ã–ª(–∞) –≤ —Å–µ—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ</div>
                </div>
                
                <button class="icon-button" id="chatMenuButton">
                    <span class="icon">‚ãÆ</span>
                </button>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- –î–∞—Ç–∞ -->
                <div class="message-date">
                    <span id="todayLabel">–°–µ–≥–æ–¥–Ω—è</span>
                </div>
                
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                <div class="message incoming">
                    <div class="message-text" id="sampleMessage1">–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?</div>
                    <div class="message-meta">
                        <span class="message-time">10:30</span>
                    </div>
                </div>
                
                <div class="message outgoing">
                    <div class="message-text" id="sampleMessage2">–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!</div>
                    <div class="message-meta">
                        <span class="message-time">10:31</span>
                        <span class="message-status read">‚úì‚úì</span>
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <div class="message-input-wrapper">
                    <textarea 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                        rows="1"
                    ></textarea>
                    <div class="input-buttons">
                        <button class="input-button" id="attachButton" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å">
                            <span class="icon">üìé</span>
                        </button>
                        <button class="input-button" id="emojiButton" title="–≠–º–æ–¥–∑–∏">
                            <span class="icon">üòä</span>
                        </button>
                    </div>
                </div>
                <button class="send-button" id="sendButton" disabled>
                    <span class="icon">‚û§</span>
                </button>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-modal-overlay" id="profileModal">
            <div class="profile-modal">
                <div class="profile-modal-header">
                    <div class="profile-modal-avatar" id="profileModalAvatar">
                        –ù
                    </div>
                    <div class="profile-modal-name" id="profileModalName">
                        –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                    </div>
                    <div class="profile-modal-username" id="profileModalUsername">
                        @user
                    </div>
                    <div class="profile-modal-phone" id="profileModalPhone">
                        +7 (777) 777-77-77
                    </div>
                    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                    <div class="profile-modal-id" id="profileModalId">
                        ID: –∑–∞–≥—Ä—É–∑–∫–∞...
                    </div>
                </div>
                
                <div class="profile-modal-menu">
                    <a class="profile-menu-item" id="editProfileMenuItem">
                        <span class="profile-menu-icon">‚úèÔ∏è</span>
                        <span class="profile-menu-text" id="editProfileText">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</span>
                        <span class="profile-menu-arrow">‚Ä∫</span>
                    </a>
                    
                    <!-- –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ Svift Premium -->
                    <a class="profile-menu-item premium-menu-item" id="premiumMenuItem">
                        <span class="profile-menu-icon">‚≠ê</span>
                        <span class="profile-menu-text" id="premiumText">Svift Premium</span>
                        <span class="premium-badge">PRO</span>
                        <span class="profile-menu-arrow">‚Ä∫</span>
                    </a>
                    
                    <a class="profile-menu-item" id="privacyMenuItem">
                        <span class="profile-menu-icon">üîí</span>
                        <span class="profile-menu-text" id="privacyText">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</span>
                        <span class="profile-menu-arrow">‚Ä∫</span>
                    </a>
                    
                    <a class="profile-menu-item" id="notificationsMenuItem">
                        <span class="profile-menu-icon">üîî</span>
                        <span class="profile-menu-text" id="notificationsText">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∑–≤—É–∫–∏</span>
                        <span class="profile-menu-arrow">‚Ä∫</span>
                    </a>
                    
                    <a class="profile-menu-item" id="languageMenuItem">
                        <span class="profile-menu-icon">üåê</span>
                        <span class="profile-menu-text" id="languageText">–Ø–∑—ã–∫</span>
                        <span class="profile-menu-text" id="currentLanguageText" style="color: #8e8e93; font-size: 14px; margin-left: auto; margin-right: 8px;">–†—É—Å—Å–∫–∏–π</span>
                        <span class="profile-menu-arrow">‚Ä∫</span>
                    </a>
                </div>
                
                <div class="profile-modal-footer">
                    <button class="profile-logout-button" id="logoutButton">
                        <span id="logoutText">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Svift Premium -->
        <div class="premium-modal-overlay" id="premiumModal">
            <div class="premium-modal">
                <div class="premium-modal-header">
                    <h3 id="premiumModalTitle">Svift Premium</h3>
                    <p class="premium-subtitle" id="premiumModalSubtitle">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞</p>
                    <button class="premium-modal-close" id="closePremiumModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                
                <div class="premium-modal-content">
                    <div class="premium-feature">
                        <div class="premium-feature-icon">‚≠ê</div>
                        <div class="premium-feature-content">
                            <div class="premium-feature-title" id="premiumFeature1Title">–ü—Ä–µ–º–∏—É–º –∑–Ω–∞—á–æ–∫</div>
                            <div class="premium-feature-description" id="premiumFeature1Desc">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∑–Ω–∞—á–æ–∫ Premium —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º –∏–º–µ–Ω–µ–º –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ —á–∞—Ç–∞—Ö</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <div class="premium-feature-icon">üòä</div>
                        <div class="premium-feature-content">
                            <div class="premium-feature-title" id="premiumFeature2Title">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å—Ç–∏–∫–µ—Ä—ã –∏ —ç–º–æ–¥–∑–∏</div>
                            <div class="premium-feature-description" id="premiumFeature2Desc">–î–æ—Å—Ç—É–ø –∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –Ω–∞–±–æ—Ä–∞–º —ç–º–æ–¥–∑–∏ –∏ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–æ–≤</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <div class="premium-feature-icon">üöÄ</div>
                        <div class="premium-feature-content">
                            <div class="premium-feature-title" id="premiumFeature3Title">–ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã</div>
                            <div class="premium-feature-description" id="premiumFeature3Desc">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞</div>
                        </div>
                    </div>
                </div>
                
                <div class="premium-footer">
                    <button class="premium-button" id="buyPremiumButton">
                        <span id="buyPremiumButtonText">–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –∑–∞ 0‚ÇΩ</span>
                    </button>
                    <div class="premium-price" id="premiumPriceText">–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è</div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="edit-profile-modal-overlay" id="editProfileModal">
            <div class="edit-profile-modal">
                <div class="edit-profile-modal-header">
                    <h3 id="editProfileModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                    <button class="edit-profile-modal-close" id="closeEditProfileModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                <div class="edit-profile-modal-content">
                    <div class="avatar-edit-container">
                        <div class="avatar-edit-preview" id="avatarPreview">
                            –ù
                        </div>
                        <button class="change-avatar-button" id="changeAvatarButton">
                            <span id="changeAvatarText">–ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞</span>
                        </button>
                        <div class="avatar-colors" id="avatarColors">
                            <!-- –¶–≤–µ—Ç–∞ –∞–≤–∞—Ç–∞—Ä–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                    
                    <div>
                        <label class="profile-edit-label" id="nameLabel">–ò–º—è</label>
                        <input type="text" class="profile-edit-input" id="editNameInput" placeholder="–í–∞—à–µ –∏–º—è" value="–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" autocomplete="name">
                    </div>
                    
                    <div>
                        <label class="profile-edit-label" id="usernameLabel">–Æ–∑–µ—Ä–Ω–µ–π–º</label>
                        <input type="text" class="profile-edit-input" id="editUsernameInput" placeholder="@username" value="user" autocomplete="username">
                    </div>
                    
                    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ID –≤ –æ–∫–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
                    <div>
                        <label class="profile-edit-label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <div class="user-id-display" id="editProfileIdDisplay">
                            ID: –∑–∞–≥—Ä—É–∑–∫–∞...
                        </div>
                    </div>
                    
                    <button class="save-profile-button" id="saveProfileButton">
                        <span id="saveProfileText">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ -->
        <div class="settings-modal-overlay" id="privacyModal">
            <div class="settings-modal">
                <div class="settings-modal-header">
                    <h3 id="privacyModalTitle">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</h3>
                    <button class="settings-modal-close" id="closePrivacyModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                <div class="settings-modal-content">
                    <div class="settings-option">
                        <div class="settings-option-label" id="lastSeenLabel">–ö—Ç–æ –≤–∏–¥–∏—Ç –≤—Ä–µ–º—è –∑–∞—Ö–æ–¥–∞</div>
                        <div class="settings-option-value" id="lastSeenValue">–í—Å–µ</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
        <div class="settings-modal-overlay" id="notificationsModal">
            <div class="settings-modal">
                <div class="settings-modal-header">
                    <h3 id="notificationsModalTitle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∑–≤—É–∫–∏</h3>
                    <button class="settings-modal-close" id="closeNotificationsModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                <div class="settings-modal-content">
                    <div class="settings-option">
                        <div class="settings-option-label" id="soundLabel">–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
                        <label class="settings-toggle">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="settings-toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —è–∑—ã–∫–∞ -->
        <div class="settings-modal-overlay" id="languageModal">
            <div class="settings-modal">
                <div class="settings-modal-header">
                    <h3 id="languageModalTitle">–Ø–∑—ã–∫</h3>
                    <button class="settings-modal-close" id="closeLanguageModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                <div class="settings-modal-content">
                    <div class="settings-option" id="languageOptionRu">
                        <div class="settings-option-label">–†—É—Å—Å–∫–∏–π</div>
                    </div>
                    <div class="settings-option" id="languageOptionEn">
                        <div class="settings-option-label">English</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞/–∫–∞–Ω–∞–ª–∞ -->
        <div class="create-channel-modal-overlay" id="createChannelModal">
            <div class="create-channel-modal">
                <div class="create-channel-header">
                    <h3 id="createChannelModalTitle">–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª</h3>
                    <button class="create-channel-close" id="closeCreateChannelModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                <div class="create-channel-content">
                    <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ -->
                    <div class="channel-step active" id="step1">
                        <div class="channel-step-title" id="step1Title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</div>
                        <div class="channel-step-description" id="step1Description">–ö–∞–∫–æ–π –∫–∞–Ω–∞–ª –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?</div>
                        
                        <div class="channel-type-selector">
                            <div class="channel-type-option" data-type="chat">
                                <div class="channel-type-icon">üí¨</div>
                                <div class="channel-type-info">
                                    <div class="channel-type-name" id="chatTypeName">–ß–∞—Ç</div>
                                    <div class="channel-type-description" id="chatTypeDescription">–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –±–µ—Å–µ–¥–∞ –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π –≥—Ä—É–ø–ø—ã –ª—é–¥–µ–π</div>
                                </div>
                            </div>
                            
                            <div class="channel-type-option" data-type="channel">
                                <div class="channel-type-icon">üì¢</div>
                                <div class="channel-type-info">
                                    <div class="channel-type-name" id="channelTypeName">–ö–∞–Ω–∞–ª</div>
                                    <div class="channel-type-description" id="channelTypeDescription">–ü—É–±–ª–∏—á–Ω–æ–µ –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –®–∞–≥ 2: –ù–∞–∑–≤–∞–Ω–∏–µ -->
                    <div class="channel-step" id="step2">
                        <div class="channel-step-title" id="step2Title">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</div>
                        <div class="channel-step-description" id="step2Description">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</div>
                        
                        <div class="channel-input-container">
                            <label class="channel-input-label" id="channelNameLabel">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</label>
                            <div class="channel-input-wrapper">
                                <input 
                                    type="text" 
                                    class="channel-input" 
                                    id="channelNameInput" 
                                    placeholder="–ú–æ–π –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª"
                                    autocomplete="off"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <!-- –®–∞–≥ 3: –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å -->
                    <div class="channel-step" id="step3">
                        <div class="channel-step-title" id="step3Title">–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</div>
                        <div class="channel-step-description" id="step3Description">–í—ã–±–µ—Ä–∏—Ç–µ, –∫—Ç–æ —Å–º–æ–∂–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–∞–Ω–∞–ª—É</div>
                        
                        <div class="privacy-selector">
                            <div class="privacy-option" data-privacy="private">
                                <div class="privacy-icon">üîí</div>
                                <div class="privacy-info">
                                    <div class="privacy-name" id="privatePrivacyName">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π</div>
                                    <div class="privacy-description" id="privatePrivacyDescription">–¢–æ–ª—å–∫–æ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é, —Å—Å—ã–ª–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</div>
                                </div>
                            </div>
                            
                            <div class="privacy-option" data-privacy="public">
                                <div class="privacy-icon">üåê</div>
                                <div class="privacy-info">
                                    <div class="privacy-name" id="publicPrivacyName">–ü—É–±–ª–∏—á–Ω—ã–π</div>
                                    <div class="privacy-description" id="publicPrivacyDescription">–õ—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –ø–æ —Å—Å—ã–ª–∫–µ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –®–∞–≥ 4: –°—Å—ã–ª–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö) -->
                    <div class="channel-step" id="step4">
                        <div class="channel-step-title" id="step4Title">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª</div>
                        <div class="channel-step-description" id="step4Description">–°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞</div>
                        
                        <div class="channel-input-container">
                            <label class="channel-input-label" id="channelLinkLabel">–°—Å—ã–ª–∫–∞ –∫–∞–Ω–∞–ª–∞</label>
                            <div class="channel-input-wrapper">
                                <div class="channel-link-prefix">svift.me/</div>
                                <input 
                                    type="text" 
                                    class="channel-input" 
                                    id="channelLinkInput" 
                                    placeholder="monk"
                                    autocomplete="off"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <!-- –®–∞–≥ 5: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ -->
                    <div class="channel-step" id="step5">
                        <div class="channel-step-title" id="step5Title">–ì–æ—Ç–æ–≤–æ!</div>
                        <div class="channel-step-description" id="step5Description">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª</div>
                        
                        <div class="channel-input-container">
                            <div style="background: #3a3a3a; border-radius: 12px; padding: 20px;">
                                <div style="color: #8e8e93; font-size: 14px; margin-bottom: 8px;">–¢–∏–ø:</div>
                                <div style="color: #ffffff; font-size: 16px; font-weight: 500; margin-bottom: 16px;" id="summaryType">–ß–∞—Ç</div>
                                
                                <div style="color: #8e8e93; font-size: 14px; margin-bottom: 8px;">–ù–∞–∑–≤–∞–Ω–∏–µ:</div>
                                <div style="color: #ffffff; font-size: 16px; font-weight: 500; margin-bottom: 16px;" id="summaryName">–ú–æ–π –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª</div>
                                
                                <div style="color: #8e8e93; font-size: 14px; margin-bottom: 8px;">–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å:</div>
                                <div style="color: #ffffff; font-size: 16px; font-weight: 500; margin-bottom: 16px;" id="summaryPrivacy">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π</div>
                                
                                <div style="color: #8e8e93; font-size: 14px; margin-bottom: 8px;" id="summaryLinkLabel">–°—Å—ã–ª–∫–∞:</div>
                                <div style="color: #ffffff; font-size: 16px; font-weight: 500;" id="summaryLink">-</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="create-channel-footer">
                    <button class="channel-button back" id="channelBackButton" disabled>
                        <span id="channelBackText">–ù–∞–∑–∞–¥</span>
                    </button>
                    <button class="channel-button next" id="channelNextButton">
                        <span id="channelNextText">–î–∞–ª–µ–µ</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É -->
        <div class="search-users-modal-overlay" id="searchUsersModal">
            <div class="search-users-modal">
                <div class="search-users-header">
                    <h3 id="searchUsersModalTitle">–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <button class="search-users-close" id="closeSearchUsersModal">
                        <span class="icon">√ó</span>
                    </button>
                </div>
                <div class="search-users-content">
                    <div class="search-users-input-container">
                        <div class="search-users-input-wrapper">
                            <span class="icon">@</span>
                            <input 
                                type="text" 
                                class="search-users-input" 
                                id="searchUsersInput" 
                                placeholder="–í–≤–µ–¥–∏—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º"
                                autocomplete="off"
                            >
                        </div>
                    </div>
                    
                    <div class="search-users-results" id="searchUsersResults">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        <div class="no-users-found">
                            <span class="no-users-found-icon">üîç</span>
                            <div class="no-users-found-text">–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                    </div>
                    
                    <div class="search-users-history" id="searchHistorySection">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================
        // –ë–ê–ó–ê –î–ê–ù–ù–´–• –° –ü–û–õ–ù–û–ô –°–¢–†–£–ö–¢–£–†–û–ô –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        // ============================================

        // –ö–ª—é—á–∏ –¥–ª—è localStorage
        const SVIFT_USERS_DB_KEY = 'svift_users_database_v2';
        const SVIFT_CHATS_DB_KEY = 'svift_chats_database_v2';
        const SVIFT_SEARCH_HISTORY_KEY = 'svift_search_history_database';
        const SVIFT_SETTINGS_KEY = 'svift_settings_database';
        const SVIFT_CURRENT_USER_KEY = 'svift_current_user';

        // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        class UserDatabase {
            constructor() {
                this.users = this.loadUsers();
                this.currentUserId = this.loadCurrentUserId();
                this.settings = this.loadSettings();
                this.searchHistory = this.loadSearchHistory();
                this.chats = this.loadChats();
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            loadUsers() {
                try {
                    const db = localStorage.getItem(SVIFT_USERS_DB_KEY);
                    if (db) {
                        return JSON.parse(db);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', e);
                }
                return [];
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            saveUsers() {
                try {
                    localStorage.setItem(SVIFT_USERS_DB_KEY, JSON.stringify(this.users));
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', e);
                    return false;
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadCurrentUserId() {
                try {
                    const currentUser = localStorage.getItem(SVIFT_CURRENT_USER_KEY);
                    if (currentUser) {
                        return parseInt(currentUser);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                }
                return null;
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            saveCurrentUserId() {
                try {
                    localStorage.setItem(SVIFT_CURRENT_USER_KEY, this.currentUserId?.toString() || '');
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                    return false;
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            loadSettings() {
                try {
                    const settings = localStorage.getItem(SVIFT_SETTINGS_KEY);
                    if (settings) {
                        return JSON.parse(settings);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
                }
                return {
                    lastSeen: 'all',
                    soundEnabled: true,
                    language: 'ru',
                    theme: 'dark'
                };
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            saveSettings() {
                try {
                    localStorage.setItem(SVIFT_SETTINGS_KEY, JSON.stringify(this.settings));
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
                    return false;
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
            loadSearchHistory() {
                try {
                    const history = localStorage.getItem(SVIFT_SEARCH_HISTORY_KEY);
                    if (history) {
                        return JSON.parse(history);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞:', e);
                }
                return [];
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
            saveSearchHistory() {
                try {
                    localStorage.setItem(SVIFT_SEARCH_HISTORY_KEY, JSON.stringify(this.searchHistory));
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞:', e);
                    return false;
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤
            loadChats() {
                try {
                    const chats = localStorage.getItem(SVIFT_CHATS_DB_KEY);
                    if (chats) {
                        return JSON.parse(chats);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', e);
                }
                return [];
            }

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤
            saveChats() {
                try {
                    localStorage.setItem(SVIFT_CHATS_DB_KEY, JSON.stringify(this.chats));
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Ç–æ–≤:', e);
                    return false;
                }
            }

            // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            getCurrentUser() {
                if (this.currentUserId) {
                    return this.users.find(user => user.id === this.currentUserId);
                }
                return null;
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            setCurrentUser(userId) {
                this.currentUserId = userId;
                this.saveCurrentUserId();
            }

            // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            addUser(userData) {
                const newId = Date.now();
                const newUser = {
                    id: newId,
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    lastSeen: Date.now(),
                    isOnline: true,
                    ...userData
                };
                
                this.users.push(newUser);
                this.saveUsers();
                return newUser;
            }

            // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            updateUser(userId, updates) {
                const userIndex = this.users.findIndex(user => user.id === userId);
                if (userIndex !== -1) {
                    this.users[userIndex] = {
                        ...this.users[userIndex],
                        ...updates,
                        updatedAt: Date.now()
                    };
                    this.saveUsers();
                    return this.users[userIndex];
                }
                return null;
            }

            // –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
            findUserById(userId) {
                return this.users.find(user => user.id === userId);
            }

            // –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ username
            findUserByUsername(username) {
                return this.users.find(user => 
                    user.username && user.username.toLowerCase() === username.toLowerCase()
                );
            }

            // –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            findUserByPhone(phone) {
                return this.users.find(user => user.phone === phone);
            }

            // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            searchUsers(query) {
                const q = query.toLowerCase();
                return this.users.filter(user => 
                    (user.username && user.username.toLowerCase().includes(q)) ||
                    (user.name && user.name.toLowerCase().includes(q)) ||
                    (user.phone && user.phone.toLowerCase().includes(q))
                );
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            getAllUsers() {
                return [...this.users];
            }

            // –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            deleteUser(userId) {
                const userIndex = this.users.findIndex(user => user.id === userId);
                if (userIndex !== -1) {
                    this.users.splice(userIndex, 1);
                    this.saveUsers();
                    return true;
                }
                return false;
            }

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ username
            isUsernameTaken(username, excludeUserId = null) {
                return this.users.some(user => 
                    user.username && 
                    user.username.toLowerCase() === username.toLowerCase() &&
                    user.id !== excludeUserId
                );
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ username
            generateUniqueUsername(baseUsername) {
                let username = baseUsername.toLowerCase().replace(/[^a-z0-9_]/g, '');
                let counter = 1;
                let finalUsername = username;
                
                while (this.isUsernameTaken(finalUsername)) {
                    finalUsername = `${username}${counter}`;
                    counter++;
                }
                
                return finalUsername;
            }

            // –î–æ–±–∞–≤–∏—Ç—å —á–∞—Ç
            addChat(chatData) {
                const newChat = {
                    id: Date.now(),
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    ...chatData
                };
                
                this.chats.push(newChat);
                this.saveChats();
                return newChat;
            }

            // –û–±–Ω–æ–≤–∏—Ç—å —á–∞—Ç
            updateChat(chatId, updates) {
                const chatIndex = this.chats.findIndex(chat => chat.id === chatId);
                if (chatIndex !== -1) {
                    this.chats[chatIndex] = {
                        ...this.chats[chatIndex],
                        ...updates,
                        updatedAt: Date.now()
                    };
                    this.saveChats();
                    return this.chats[chatIndex];
                }
                return null;
            }

            // –ù–∞–π—Ç–∏ —á–∞—Ç –ø–æ ID
            findChatById(chatId) {
                return this.chats.find(chat => chat.id === chatId);
            }

            // –ù–∞–π—Ç–∏ —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            findUserChats(userId) {
                return this.chats.filter(chat => 
                    chat.participants && chat.participants.includes(userId)
                );
            }

            // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
            addMessageToChat(chatId, messageData) {
                const chat = this.findChatById(chatId);
                if (chat) {
                    if (!chat.messages) {
                        chat.messages = [];
                    }
                    
                    const newMessage = {
                        id: Date.now(),
                        timestamp: Date.now(),
                        ...messageData
                    };
                    
                    chat.messages.push(newMessage);
                    chat.lastMessage = messageData.text;
                    chat.lastMessageTime = Date.now();
                    chat.updatedAt = Date.now();
                    
                    this.saveChats();
                    return newMessage;
                }
                return null;
            }

            // –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
            clearSearchHistory() {
                this.searchHistory = [];
                this.saveSearchHistory();
            }

            // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
            addToSearchHistory(query, results) {
                const existingIndex = this.searchHistory.findIndex(item => item.query === query);
                
                if (existingIndex !== -1) {
                    this.searchHistory[existingIndex] = {
                        ...this.searchHistory[existingIndex],
                        timestamp: Date.now(),
                        results: results
                    };
                } else {
                    this.searchHistory.unshift({
                        id: Date.now(),
                        query: query,
                        timestamp: Date.now(),
                        results: results
                    });
                    
                    if (this.searchHistory.length > 10) {
                        this.searchHistory.pop();
                    }
                }
                
                this.saveSearchHistory();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        const database = new UserDatabase();

        // –¢–µ–∫—Å—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
        const translations = {
            ru: {
                // –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                registrationTitle: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä",
                registrationSubtitle: "–ë—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä",
                registrationSubtitleText: "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ Svift",
                phoneInputLabel: "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
                continueButtonText: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
                termsText: "–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É \"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å\", –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ",
                termsLink: "–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",
                
                // –≠–∫—Ä–∞–Ω —á–∞—Ç–æ–≤
                searchPlaceholder: "–ü–æ–∏—Å–∫",
                pinnedChatsTitle: "–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",
                allChatsTitle: "–í—Å–µ —á–∞—Ç—ã",
                newChatButton: "–ù–æ–≤—ã–π —á–∞—Ç",
                searchUsernameButton: "–ü–æ–∏—Å–∫ –ø–æ —é–∑–µ—Ä–Ω–µ–π–º—É",
                profileButton: "–ü—Ä–æ—Ñ–∏–ª—å",
                
                // –≠–∫—Ä–∞–Ω –¥–∏–∞–ª–æ–≥–∞
                backButton: "–ù–∞–∑–∞–¥",
                messageInputPlaceholder: "–°–æ–æ–±—â–µ–Ω–∏–µ...",
                attachButton: "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å",
                emojiButton: "–≠–º–æ–¥–∑–∏",
                todayLabel: "–°–µ–≥–æ–¥–Ω—è",
                onlineStatus: "–≤ —Å–µ—Ç–∏",
                recentlyOnline: "–±—ã–ª(–∞) –≤ —Å–µ—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ",
                sampleMessage1: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
                sampleMessage2: "–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
                editProfileText: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",
                premiumText: "Svift Premium",
                privacyText: "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å",
                notificationsText: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∑–≤—É–∫–∏",
                languageText: "–Ø–∑—ã–∫",
                logoutText: "–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Premium
                premiumModalTitle: "Svift Premium",
                premiumModalSubtitle: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–∞",
                premiumFeature1Title: "–ü—Ä–µ–º–∏—É–º –∑–Ω–∞—á–æ–∫",
                premiumFeature1Desc: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∑–Ω–∞—á–æ–∫ Premium —Ä—è–¥–æ–º —Å –≤–∞—à–∏–º –∏–º–µ–Ω–µ–º –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ —á–∞—Ç–∞—Ö",
                premiumFeature2Title: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å—Ç–∏–∫–µ—Ä—ã –∏ —ç–º–æ–¥–∑–∏",
                premiumFeature2Desc: "–î–æ—Å—Ç—É–ø –∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –Ω–∞–±–æ—Ä–∞–º —ç–º–æ–¥–∑–∏ –∏ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–æ–≤",
                premiumFeature3Title: "–ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã",
                premiumFeature3Desc: "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –ª—é–±–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞",
                buyPremiumButtonText: "–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –∑–∞ 0‚ÇΩ",
                premiumPriceText: "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
                editProfileModalTitle: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",
                changeAvatarText: "–ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞",
                nameLabel: "–ò–º—è",
                namePlaceholder: "–í–∞—à–µ –∏–º—è",
                usernameLabel: "–Æ–∑–µ—Ä–Ω–µ–π–º",
                usernamePlaceholder: "@username",
                saveProfileText: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                privacyModalTitle: "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å",
                lastSeenLabel: "–ö—Ç–æ –≤–∏–¥–∏—Ç –≤—Ä–µ–º—è –∑–∞—Ö–æ–¥–∞",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                notificationsModalTitle: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∑–≤—É–∫–∏",
                soundLabel: "–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —è–∑—ã–∫–∞
                languageModalTitle: "–Ø–∑—ã–∫",
                
                // –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞—Ö–æ–¥–∞
                lastSeenAll: "–í—Å–µ",
                lastSeenContacts: "–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã",
                lastSeenNobody: "–ù–∏–∫—Ç–æ",
                
                // –°–æ–æ–±—â–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                welcomeMessage: "‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Svift!",
                phoneError: "‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
                profileUpdated: "‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω",
                premiumActivated: "‚≠ê –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å Svift Premium!",
                alreadyPremium: "‚úÖ –£ –≤–∞—Å —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω Svift Premium",
                soundOn: "üîî –ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–∫–ª—é—á–µ–Ω",
                soundOff: "üîï –ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—ã–∫–ª—é—á–µ–Ω",
                languageChangedRu: "üá∑üá∫ –Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –†—É—Å—Å–∫–∏–π",
                languageChangedEn: "üá∫üá∏ Language changed to English",
                newChatFunction: "‚úèÔ∏è –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞",
                attachFunction: "üìé –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤",
                emojiFunction: "üòä –í—ã–±–æ—Ä —ç–º–æ–¥–∑–∏",
                logoutConfirm: "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?",
                loggedOut: "–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞",
                lastSeenAllMessage: "–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –≤—Ä–µ–º—è –≤–∞—à–µ–≥–æ –∑–∞—Ö–æ–¥–∞",
                lastSeenContactsMessage: "–¢–æ–ª—å–∫–æ –≤–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤–∏–¥—è—Ç –≤—Ä–µ–º—è –∑–∞—Ö–æ–¥–∞",
                lastSeenNobodyMessage: "–í—Ä–µ–º—è –≤–∞—à–µ–≥–æ –∑–∞—Ö–æ–¥–∞ —Å–∫—Ä—ã—Ç–æ",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
                createChannelModalTitle: "–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª",
                step1Title: "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø",
                step1Description: "–ö–∞–∫–æ–π –∫–∞–Ω–∞–ª –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?",
                chatTypeName: "–ß–∞—Ç",
                chatTypeDescription: "–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –±–µ—Å–µ–¥–∞ –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–π –≥—Ä—É–ø–ø—ã –ª—é–¥–µ–π",
                channelTypeName: "–ö–∞–Ω–∞–ª",
                channelTypeDescription: "–ü—É–±–ª–∏—á–Ω–æ–µ –∏–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –æ–±—â–µ–Ω–∏—è",
                step2Title: "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞",
                step2Description: "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞",
                channelNameLabel: "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞",
                channelNamePlaceholder: "–ú–æ–π –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª",
                step3Title: "–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å",
                step3Description: "–í—ã–±–µ—Ä–∏—Ç–µ, –∫—Ç–æ —Å–º–æ–∂–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–∞–Ω–∞–ª—É",
                privatePrivacyName: "–ü—Ä–∏–≤–∞—Ç–Ω—ã–π",
                privatePrivacyDescription: "–¢–æ–ª—å–∫–æ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é, —Å—Å—ã–ª–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è",
                publicPrivacyName: "–ü—É–±–ª–∏—á–Ω—ã–π",
                publicPrivacyDescription: "–õ—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –ø–æ —Å—Å—ã–ª–∫–µ",
                step4Title: "–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª",
                step4Description: "–°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞",
                channelLinkLabel: "–°—Å—ã–ª–∫–∞ –∫–∞–Ω–∞–ª–∞",
                channelLinkPlaceholder: "monk",
                step5Title: "–ì–æ—Ç–æ–≤–æ!",
                step5Description: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª",
                channelBackText: "–ù–∞–∑–∞–¥",
                channelNextText: "–î–∞–ª–µ–µ",
                channelCreateText: "–°–æ–∑–¥–∞—Ç—å",
                channelCreatingText: "–°–æ–∑–¥–∞–Ω–∏–µ...",
                channelCreatedMessage: "‚úÖ –ö–∞–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!",
                channelNameError: "‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞",
                channelLinkError: "‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _)",
                channelLinkTakenError: "‚ö†Ô∏è –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞",
                summaryType: "–¢–∏–ø:",
                summaryName: "–ù–∞–∑–≤–∞–Ω–∏–µ:",
                summaryPrivacy: "–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å:",
                summaryLink: "–°—Å—ã–ª–∫–∞:",
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                searchUsersModalTitle: "–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
                searchUsersInputPlaceholder: "–í–≤–µ–¥–∏—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º",
                searchLoading: "–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...",
                noUsersFound: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
                searchError: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ",
                searchHistoryTitle: "–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞",
                clearHistory: "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é",
                startChat: "–ù–∞–ø–∏—Å–∞—Ç—å",
                userOnline: "–≤ —Å–µ—Ç–∏",
                userOffline: "–Ω–µ –≤ —Å–µ—Ç–∏",
                noSearchHistory: "–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ –ø—É—Å—Ç–∞",
                searchResult: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞",
                searchingFor: "–ü–æ–∏—Å–∫: "
            },
            en: {
                // Registration screen
                registrationTitle: "Enter your number",
                registrationSubtitle: "Fast and secure messenger",
                registrationSubtitleText: "Enter phone number to sign in to Svift",
                phoneInputLabel: "Phone number",
                continueButtonText: "Continue",
                termsText: "By clicking \"Continue\", you accept the",
                termsLink: "Terms of Use",
                
                // Chats screen
                searchPlaceholder: "Search",
                pinnedChatsTitle: "Pinned",
                allChatsTitle: "All chats",
                newChatButton: "New chat",
                searchUsernameButton: "Search by username",
                profileButton: "Profile",
                
                // Chat screen
                backButton: "Back",
                messageInputPlaceholder: "Message...",
                attachButton: "Attach",
                emojiButton: "Emoji",
                todayLabel: "Today",
                onlineStatus: "online",
                recentlyOnline: "was recently online",
                sampleMessage1: "Hello! How are you?",
                sampleMessage2: "Hi! Everything is great, thanks!",
                
                // Profile modal
                editProfileText: "Edit profile",
                premiumText: "Svift Premium",
                privacyText: "Privacy",
                notificationsText: "Notifications & Sounds",
                languageText: "Language",
                logoutText: "Log out",
                
                // Premium modal
                premiumModalTitle: "Svift Premium",
                premiumModalSubtitle: "Advanced features for your comfort",
                premiumFeature1Title: "Premium badge",
                premiumFeature1Desc: "Exclusive Premium badge next to your name in profile and chats",
                premiumFeature2Title: "Exclusive stickers & emoji",
                premiumFeature2Desc: "Access to unique sets of emoji and animated stickers",
                premiumFeature3Title: "Faster file downloads",
                premiumFeature3Desc: "Priority file upload and download of any size",
                buyPremiumButtonText: "Buy subscription for 0‚ÇΩ",
                premiumPriceText: "Subscription activates immediately after clicking",
                
                // Edit profile modal
                editProfileModalTitle: "Edit profile",
                changeAvatarText: "Change avatar color",
                nameLabel: "Name",
                namePlaceholder: "Your name",
                usernameLabel: "Username",
                usernamePlaceholder: "@username",
                saveProfileText: "Save changes",
                
                // Privacy modal
                privacyModalTitle: "Privacy",
                lastSeenLabel: "Who can see my last seen",
                
                // Notifications modal
                notificationsModalTitle: "Notifications & Sounds",
                soundLabel: "Notification sound",
                
                // Language modal
                languageModalTitle: "Language",
                
                // Last seen values
                lastSeenAll: "Everyone",
                lastSeenContacts: "Contacts only",
                lastSeenNobody: "Nobody",
                
                // Notification messages
                welcomeMessage: "‚úÖ Welcome to Svift!",
                phoneError: "‚ö†Ô∏è Please enter a valid phone number",
                profileUpdated: "‚úÖ Profile successfully updated",
                premiumActivated: "‚≠ê Congratulations! You now have Svift Premium!",
                alreadyPremium: "‚úÖ You already have Svift Premium activated",
                soundOn: "üîî Notification sound enabled",
                soundOff: "üîï Notification sound disabled",
                languageChangedRu: "üá∑üá∫ Language changed to Russian",
                languageChangedEn: "üá∫üá∏ Language changed to English",
                newChatFunction: "‚úèÔ∏è New chat function",
                attachFunction: "üìé File attachment function",
                emojiFunction: "üòä Emoji selection",
                logoutConfirm: "Are you sure you want to log out?",
                loggedOut: "You have logged out",
                lastSeenAllMessage: "Everyone can see your last seen time",
                lastSeenContactsMessage: "Only your contacts can see your last seen time",
                lastSeenNobodyMessage: "Your last seen time is hidden",
                
                // Create channel modal
                createChannelModalTitle: "Create Channel",
                step1Title: "Choose Type",
                step1Description: "What type of channel do you want to create?",
                chatTypeName: "Chat",
                chatTypeDescription: "Private conversation for a small group of people",
                channelTypeName: "Channel",
                channelTypeDescription: "Public or private space for communication",
                step2Title: "Channel Name",
                step2Description: "Enter a name for your channel",
                channelNameLabel: "Channel Name",
                channelNamePlaceholder: "My New Channel",
                step3Title: "Privacy",
                step3Description: "Choose who can join the channel",
                privatePrivacyName: "Private",
                privatePrivacyDescription: "Invite only, no link required",
                publicPrivacyName: "Public",
                publicPrivacyDescription: "Anyone can join via link",
                step4Title: "Channel Link",
                step4Description: "Create a unique link for your channel",
                channelLinkLabel: "Channel Link",
                channelLinkPlaceholder: "monk",
                step5Title: "Ready!",
                step5Description: "Review information and create channel",
                channelBackText: "Back",
                channelNextText: "Next",
                channelCreateText: "Create",
                channelCreatingText: "Creating...",
                channelCreatedMessage: "‚úÖ Channel successfully created!",
                channelNameError: "‚ö†Ô∏è Please enter channel name",
                channelLinkError: "‚ö†Ô∏è Please enter a valid link (letters, numbers and _ only)",
                channelLinkTakenError: "‚ö†Ô∏è This link is already taken",
                summaryType: "Type:",
                summaryName: "Name:",
                summaryPrivacy: "Privacy:",
                summaryLink: "Link:",
                
                // Search users modal
                searchUsersModalTitle: "Search Users",
                searchUsersInputPlaceholder: "Enter username",
                searchLoading: "Searching users...",
                noUsersFound: "No users found",
                searchError: "Search error",
                searchHistoryTitle: "Search History",
                clearHistory: "Clear history",
                startChat: "Message",
                userOnline: "online",
                userOffline: "offline",
                noSearchHistory: "Search history is empty",
                searchResult: "Search Results",
                searchingFor: "Searching for: "
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
        function initializeDemoData() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            const allUsers = database.getAllUsers();
            if (allUsers.length === 0) {
                // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID
                const demoUsers = [
                    {
                        name: "–ê–ª–µ–∫—Å–µ–π",
                        username: "alexey",
                        phone: "+7 (999) 123-45-67",
                        avatar: "–ê",
                        avatarColor: "linear-gradient(135deg, #007aff 0%, #00d4ff 100%)",
                        isOnline: true,
                        premium: false,
                        bio: "–ü—Ä–∏–≤–µ—Ç! –Ø –∏—Å–ø–æ–ª—å–∑—É—é Svift",
                        lastSeen: Date.now()
                    },
                    {
                        name: "–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞",
                        username: "anna_petrova",
                        phone: "+79123456789",
                        avatar: "–ê",
                        avatarColor: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
                        isOnline: true,
                        premium: true,
                        bio: "–õ—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å",
                        lastSeen: Date.now()
                    },
                    {
                        name: "–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤",
                        username: "ivan_sidorov",
                        phone: "+79234567890",
                        avatar: "–ò",
                        avatarColor: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",
                        isOnline: false,
                        premium: false,
                        bio: "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è",
                        lastSeen: Date.now() - 3600000
                    },
                    {
                        name: "–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞",
                        username: "maria_ivanova",
                        phone: "+79012345678",
                        avatar: "–ú",
                        avatarColor: "linear-gradient(135deg, #fa709a 0%, #fee140 100%)",
                        isOnline: true,
                        premium: false,
                        bio: "–°—Ç—É–¥–µ–Ω—Ç–∫–∞, –∏–∑—É—á–∞—é –¥–∏–∑–∞–π–Ω",
                        lastSeen: Date.now()
                    },
                    {
                        name: "–î–º–∏—Ç—Ä–∏–π –í–æ–ª–∫–æ–≤",
                        username: "dima_volkov",
                        phone: "+79567891234",
                        avatar: "–î",
                        avatarColor: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                        isOnline: true,
                        premium: false,
                        bio: "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å",
                        lastSeen: Date.now()
                    },
                    {
                        name: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞",
                        username: "kate_smirnova",
                        phone: "+79876543210",
                        avatar: "–ï",
                        avatarColor: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
                        isOnline: false,
                        premium: true,
                        bio: "–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –≤ IT –∫–æ–º–ø–∞–Ω–∏–∏",
                        lastSeen: Date.now() - 7200000
                    },
                    {
                        name: "–ú–∞–∫—Å–∏–º –û—Ä–ª–æ–≤",
                        username: "max_orlov",
                        phone: "+79111234567",
                        avatar: "–ú",
                        avatarColor: "linear-gradient(135deg, #30cfd0 0%, #330867 100%)",
                        isOnline: true,
                        premium: false,
                        bio: "–§–æ—Ç–æ–≥—Ä–∞—Ñ-—Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä",
                        lastSeen: Date.now()
                    },
                    {
                        name: "–û–ª—å–≥–∞ –ù–æ–≤–∏–∫–æ–≤–∞",
                        username: "olga_novikova",
                        phone: "+79222345678",
                        avatar: "–û",
                        avatarColor: "linear-gradient(135deg, #fa709a 0%, #fee140 100%)",
                        isOnline: true,
                        premium: false,
                        bio: "–£—á–∏—Ç–µ–ª—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
                        lastSeen: Date.now()
                    },
                    {
                        name: "–°–µ—Ä–≥–µ–π –ö–æ–∑–ª–æ–≤",
                        username: "serg_kozlov",
                        phone: "+79333456789",
                        avatar: "–°",
                        avatarColor: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",
                        isOnline: false,
                        premium: false,
                        bio: "–ò–Ω–∂–µ–Ω–µ—Ä-—Å—Ç—Ä–æ–∏—Ç–µ–ª—å",
                        lastSeen: Date.now() - 1800000
                    },
                    {
                        name: "–í–∏–∫—Ç–æ—Ä–∏—è –§–µ–¥–æ—Ä–æ–≤–∞",
                        username: "vika_fedorova",
                        phone: "+79444567890",
                        avatar: "–í",
                        avatarColor: "linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%)",
                        isOnline: true,
                        premium: true,
                        bio: "–ë–ª–æ–≥–µ—Ä –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö",
                        lastSeen: Date.now()
                    }
                ];

                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                demoUsers.forEach(user => {
                    database.addUser(user);
                });

                // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-—á–∞—Ç—ã
                const demoChats = [
                    {
                        name: "–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞",
                        type: "private",
                        participants: [demoUsers[0].id, demoUsers[1].id],
                        lastMessage: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
                        lastMessageTime: Date.now(),
                        unreadCount: 2,
                        isPinned: true,
                        isMuted: false,
                        avatar: "–ê",
                        avatarColor: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
                        messages: [
                            {
                                senderId: demoUsers[1].id,
                                text: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
                                timestamp: Date.now() - 3600000,
                                isRead: true
                            },
                            {
                                senderId: demoUsers[0].id,
                                text: "–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!",
                                timestamp: Date.now() - 3590000,
                                isRead: true
                            },
                            {
                                senderId: demoUsers[1].id,
                                text: "–û—Ç–ª–∏—á–Ω–æ! –ß—Ç–æ –Ω–æ–≤–æ–≥–æ?",
                                timestamp: Date.now() - 3580000,
                                isRead: false
                            }
                        ]
                    },
                    {
                        name: "–†–∞–±–æ—á–∞—è –≥—Ä—É–ø–ø–∞",
                        type: "group",
                        participants: [demoUsers[0].id, demoUsers[1].id, demoUsers[2].id, demoUsers[3].id],
                        lastMessage: "–î–º–∏—Ç—Ä–∏–π: –ì–æ—Ç–æ–≤—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã",
                        lastMessageTime: Date.now() - 7200000,
                        unreadCount: 15,
                        isPinned: true,
                        isMuted: true,
                        avatar: "üë•",
                        avatarColor: "linear-gradient(135deg, #007aff 0%, #00d4ff 100%)",
                        messages: [
                            {
                                senderId: demoUsers[2].id,
                                senderName: "–î–º–∏—Ç—Ä–∏–π",
                                text: "–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç!",
                                timestamp: Date.now() - 10800000,
                                isRead: true
                            },
                            {
                                senderId: demoUsers[2].id,
                                senderName: "–î–º–∏—Ç—Ä–∏–π",
                                text: "–ì–æ—Ç–æ–≤—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç—É",
                                timestamp: Date.now() - 7200000,
                                isRead: true
                            },
                            {
                                senderId: demoUsers[0].id,
                                senderName: "–ê–ª–µ–∫—Å–µ–π",
                                text: "–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!",
                                timestamp: Date.now() - 7100000,
                                isRead: true
                            }
                        ]
                    }
                ];

                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–º–æ-—á–∞—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
                demoChats.forEach(chat => {
                    database.addChat(chat);
                });
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function formatPhoneNumber(phone) {
            const cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.length === 10) {
                const match = cleaned.match(/^(\d{3})(\d{3})(\d{2})(\d{2})$/);
                if (match) {
                    return `+7 (${match[1]}) ${match[2]}-${match[3]}-${match[4]}`;
                }
            }
            return `+7${cleaned}`;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function isValidPhoneNumber(phone) {
            const cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.startsWith('7') || cleaned.startsWith('8')) {
                return cleaned.length === 11;
            } else {
                return cleaned.length === 10;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            appContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—É—é –±—É–∫–≤—É –∏–º–µ–Ω–∏ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞
        function getAvatarInitial(name) {
            if (!name || name.trim().length === 0) return '–ù';
            const firstLetter = name.trim().charAt(0).toUpperCase();
            if (/[A-Z–ê-–Ø]/.test(firstLetter)) {
                return firstLetter;
            }
            return '–ù';
        }

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const registrationScreen = document.getElementById('registrationScreen');
        const chatsScreen = document.getElementById('chatsScreen');
        const phoneInput = document.getElementById('phoneInput');
        const continueButton = document.getElementById('continueButton');
        const chatList = document.getElementById('chatList');
        const searchInput = document.getElementById('searchInput');
        const backButton = document.getElementById('backButton');
        const currentChatName = document.getElementById('currentChatName');
        const currentChatAvatar = document.getElementById('currentChatAvatar');
        const currentChatUsername = document.getElementById('currentChatUsername');
        const currentChatStatus = document.getElementById('currentChatStatus');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const profileButton = document.getElementById('profileButton');
        const profileModal = document.getElementById('profileModal');
        const userAvatar = document.getElementById('userAvatar');
        const profileModalAvatar = document.getElementById('profileModalAvatar');
        const profileModalName = document.getElementById('profileModalName');
        const profileModalUsername = document.getElementById('profileModalUsername');
        const profileModalPhone = document.getElementById('profileModalPhone');
        const profileModalId = document.getElementById('profileModalId');
        const editProfileModal = document.getElementById('editProfileModal');
        const editNameInput = document.getElementById('editNameInput');
        const editUsernameInput = document.getElementById('editUsernameInput');
        const editProfileIdDisplay = document.getElementById('editProfileIdDisplay');
        const avatarPreview = document.getElementById('avatarPreview');
        const avatarColors = document.getElementById('avatarColors');
        const saveProfileButton = document.getElementById('saveProfileButton');
        const closeEditProfileModal = document.getElementById('closeEditProfileModal');
        const editProfileMenuItem = document.getElementById('editProfileMenuItem');
        const logoutButton = document.getElementById('logoutButton');
        const changeAvatarButton = document.getElementById('changeAvatarButton');
        
        // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const privacyMenuItem = document.getElementById('privacyMenuItem');
        const notificationsMenuItem = document.getElementById('notificationsMenuItem');
        const languageMenuItem = document.getElementById('languageMenuItem');
        const privacyModal = document.getElementById('privacyModal');
        const notificationsModal = document.getElementById('notificationsModal');
        const languageModal = document.getElementById('languageModal');
        const closePrivacyModal = document.getElementById('closePrivacyModal');
        const closeNotificationsModal = document.getElementById('closeNotificationsModal');
        const closeLanguageModal = document.getElementById('closeLanguageModal');
        const lastSeenValue = document.getElementById('lastSeenValue');
        const soundToggle = document.getElementById('soundToggle');
        const languageOptionRu = document.getElementById('languageOptionRu');
        const languageOptionEn = document.getElementById('languageOptionEn');
        
        // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è Premium
        const premiumMenuItem = document.getElementById('premiumMenuItem');
        const premiumModal = document.getElementById('premiumModal');
        const closePremiumModal = document.getElementById('closePremiumModal');
        const buyPremiumButton = document.getElementById('buyPremiumButton');
        
        // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
        const newChatButton = document.getElementById('newChatButton');
        const createChannelModal = document.getElementById('createChannelModal');
        const closeCreateChannelModal = document.getElementById('closeCreateChannelModal');
        const channelTypeOptions = document.querySelectorAll('.channel-type-option');
        const channelNameInput = document.getElementById('channelNameInput');
        const privacyOptions = document.querySelectorAll('.privacy-option');
        const channelLinkInput = document.getElementById('channelLinkInput');
        const channelBackButton = document.getElementById('channelBackButton');
        const channelNextButton = document.getElementById('channelNextButton');
        const summaryType = document.getElementById('summaryType');
        const summaryName = document.getElementById('summaryName');
        const summaryPrivacy = document.getElementById('summaryPrivacy');
        const summaryLink = document.getElementById('summaryLink');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');
        const step5 = document.getElementById('step5');

        // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const searchUsernameButton = document.getElementById('searchUsernameButton');
        const searchUsersModal = document.getElementById('searchUsersModal');
        const closeSearchUsersModal = document.getElementById('closeSearchUsersModal');
        const searchUsersInput = document.getElementById('searchUsersInput');
        const searchUsersResults = document.getElementById('searchUsersResults');
        const searchHistorySection = document.getElementById('searchHistorySection');
        const searchUsersModalTitle = document.getElementById('searchUsersModalTitle');

        let currentChatId = null;
        let currentStep = 1;
        let channelData = {
            type: 'chat',
            name: '',
            privacy: 'private',
            link: ''
        };

        // –¶–≤–µ—Ç–∞ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
        const avatarColorOptions = [
            { name: "–°–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç", value: "linear-gradient(135deg, #007aff 0%, #00d4ff 100%)" },
            { name: "–§–∏–æ–ª–µ—Ç–æ–≤—ã–π", value: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)" },
            { name: "–†–æ–∑–æ–≤—ã–π", value: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)" },
            { name: "–ó–µ–ª–µ–Ω—ã–π", value: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)" },
            { name: "–û—Ä–∞–Ω–∂–µ–≤—ã–π", value: "linear-gradient(135deg, #fa709a 0%, #fee140 100%)" },
            { name: "–ë–∏—Ä—é–∑–æ–≤—ã–π", value: "linear-gradient(135deg, #30cfd0 0%, #330867 100%)" },
            { name: "–ö—Ä–∞—Å–Ω—ã–π", value: "linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%)" },
            { name: "–ó–æ–ª–æ—Ç–æ–π", value: "linear-gradient(135deg, #f6d365 0%, #fda085 100%)" }
        ];

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function translateInterface(language) {
            const lang = translations[language];
            
            // –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('registrationTitle').textContent = lang.registrationTitle;
            document.getElementById('registrationSubtitle').textContent = lang.registrationSubtitle;
            document.getElementById('registrationSubtitleText').textContent = lang.registrationSubtitleText;
            document.getElementById('phoneInputLabel').textContent = lang.phoneInputLabel;
            document.getElementById('continueButtonText').textContent = lang.continueButtonText;
            document.getElementById('termsText').textContent = lang.termsText;
            document.getElementById('termsLink').textContent = lang.termsLink;
            
            // –≠–∫—Ä–∞–Ω —á–∞—Ç–æ–≤
            searchInput.placeholder = lang.searchPlaceholder;
            document.getElementById('pinnedChatsTitle').textContent = lang.pinnedChatsTitle;
            document.getElementById('allChatsTitle').textContent = lang.allChatsTitle;
            
            // –≠–∫—Ä–∞–Ω –¥–∏–∞–ª–æ–≥–∞
            messageInput.placeholder = lang.messageInputPlaceholder;
            document.getElementById('todayLabel').textContent = lang.todayLabel;
            document.getElementById('sampleMessage1').textContent = lang.sampleMessage1;
            document.getElementById('sampleMessage2').textContent = lang.sampleMessage2;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('editProfileText').textContent = lang.editProfileText;
            document.getElementById('premiumText').textContent = lang.premiumText;
            document.getElementById('privacyText').textContent = lang.privacyText;
            document.getElementById('notificationsText').textContent = lang.notificationsText;
            document.getElementById('languageText').textContent = lang.languageText;
            document.getElementById('logoutText').textContent = lang.logoutText;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Premium
            document.getElementById('premiumModalTitle').textContent = lang.premiumModalTitle;
            document.getElementById('premiumModalSubtitle').textContent = lang.premiumModalSubtitle;
            document.getElementById('premiumFeature1Title').textContent = lang.premiumFeature1Title;
            document.getElementById('premiumFeature1Desc').textContent = lang.premiumFeature1Desc;
            document.getElementById('premiumFeature2Title').textContent = lang.premiumFeature2Title;
            document.getElementById('premiumFeature2Desc').textContent = lang.premiumFeature2Desc;
            document.getElementById('premiumFeature3Title').textContent = lang.premiumFeature3Title;
            document.getElementById('premiumFeature3Desc').textContent = lang.premiumFeature3Desc;
            document.getElementById('buyPremiumButtonText').textContent = lang.buyPremiumButtonText;
            document.getElementById('premiumPriceText').textContent = lang.premiumPriceText;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('editProfileModalTitle').textContent = lang.editProfileModalTitle;
            document.getElementById('changeAvatarText').textContent = lang.changeAvatarText;
            document.getElementById('nameLabel').textContent = lang.nameLabel;
            editNameInput.placeholder = lang.namePlaceholder;
            document.getElementById('usernameLabel').textContent = lang.usernameLabel;
            editUsernameInput.placeholder = lang.usernamePlaceholder;
            document.getElementById('saveProfileText').textContent = lang.saveProfileText;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
            document.getElementById('privacyModalTitle').textContent = lang.privacyModalTitle;
            document.getElementById('lastSeenLabel').textContent = lang.lastSeenLabel;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            document.getElementById('notificationsModalTitle').textContent = lang.notificationsModalTitle;
            document.getElementById('soundLabel').textContent = lang.soundLabel;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —è–∑—ã–∫–∞
            document.getElementById('languageModalTitle').textContent = lang.languageModalTitle;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
            document.getElementById('createChannelModalTitle').textContent = lang.createChannelModalTitle;
            document.getElementById('step1Title').textContent = lang.step1Title;
            document.getElementById('step1Description').textContent = lang.step1Description;
            document.getElementById('chatTypeName').textContent = lang.chatTypeName;
            document.getElementById('chatTypeDescription').textContent = lang.chatTypeDescription;
            document.getElementById('channelTypeName').textContent = lang.channelTypeName;
            document.getElementById('channelTypeDescription').textContent = lang.channelTypeDescription;
            document.getElementById('step2Title').textContent = lang.step2Title;
            document.getElementById('step2Description').textContent = lang.step2Description;
            document.getElementById('channelNameLabel').textContent = lang.channelNameLabel;
            channelNameInput.placeholder = lang.channelNamePlaceholder;
            document.getElementById('step3Title').textContent = lang.step3Title;
            document.getElementById('step3Description').textContent = lang.step3Description;
            document.getElementById('privatePrivacyName').textContent = lang.privatePrivacyName;
            document.getElementById('privatePrivacyDescription').textContent = lang.privatePrivacyDescription;
            document.getElementById('publicPrivacyName').textContent = lang.publicPrivacyName;
            document.getElementById('publicPrivacyDescription').textContent = lang.publicPrivacyDescription;
            document.getElementById('step4Title').textContent = lang.step4Title;
            document.getElementById('step4Description').textContent = lang.step4Description;
            document.getElementById('channelLinkLabel').textContent = lang.channelLinkLabel;
            channelLinkInput.placeholder = lang.channelLinkPlaceholder;
            document.getElementById('step5Title').textContent = lang.step5Title;
            document.getElementById('step5Description').textContent = lang.step5Description;
            document.getElementById('channelBackText').textContent = lang.channelBackText;
            document.getElementById('channelNextText').textContent = lang.channelNextText;
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            searchUsersModalTitle.textContent = lang.searchUsersModalTitle;
            searchUsersInput.placeholder = lang.searchUsersInputPlaceholder;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞ –≤ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('currentLanguageText').textContent = 
                language === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'English';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileDisplay() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
            userAvatar.textContent = currentUser.avatar || getAvatarInitial(currentUser.name);
            userAvatar.style.background = currentUser.avatarColor || avatarColorOptions[0].value;
            
            profileModalAvatar.textContent = currentUser.avatar || getAvatarInitial(currentUser.name);
            profileModalAvatar.style.background = currentUser.avatarColor || avatarColorOptions[0].value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            profileModalName.textContent = currentUser.name || "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
            profileModalUsername.textContent = currentUser.username ? `@${currentUser.username}` : '';
            profileModalPhone.textContent = currentUser.phone || '+7 (777) 777-77-77';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            profileModalId.textContent = `ID: ${currentUser.id}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ID –≤ –æ–∫–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
            if (editProfileIdDisplay) {
                editProfileIdDisplay.textContent = `ID: ${currentUser.id}`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞
            avatarPreview.textContent = currentUser.avatar || getAvatarInitial(currentUser.name);
            avatarPreview.style.background = currentUser.avatarColor || avatarColorOptions[0].value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            editNameInput.value = currentUser.name || '';
            editUsernameInput.value = currentUser.username || '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º Premium —Å—Ç–∞—Ç—É—Å
            updatePremiumDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è Premium —Å—Ç–∞—Ç—É—Å–∞
        function updatePremiumDisplay() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            if (currentUser.premium) {
                userAvatar.classList.add('premium-avatar');
                profileModalAvatar.classList.add('premium-avatar');
                
                const premiumBadge = document.querySelector('.premium-badge');
                if (premiumBadge) {
                    premiumBadge.textContent = 'PRO';
                }
                
                const premiumMenuItemText = document.querySelector('#premiumMenuItem .profile-menu-text');
                if (premiumMenuItemText) {
                    premiumMenuItemText.textContent = database.settings.language === 'ru' ? 
                        'Svift Premium ‚úì' : 'Svift Premium ‚úì';
                }
            } else {
                userAvatar.classList.remove('premium-avatar');
                profileModalAvatar.classList.remove('premium-avatar');
                
                const premiumMenuItemText = document.querySelector('#premiumMenuItem .profile-menu-text');
                if (premiumMenuItemText) {
                    premiumMenuItemText.textContent = database.settings.language === 'ru' ? 
                        'Svift Premium' : 'Svift Premium';
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function updateSettingsDisplay() {
            const lang = translations[database.settings.language];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞—Ö–æ–¥–∞
            const lastSeenTexts = {
                'all': database.settings.language === 'ru' ? '–í—Å–µ' : 'Everyone',
                'contacts': database.settings.language === 'ru' ? '–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã' : 'Contacts only',
                'nobody': database.settings.language === 'ru' ? '–ù–∏–∫—Ç–æ' : 'Nobody'
            };
            lastSeenValue.textContent = lastSeenTexts[database.settings.lastSeen];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–≤—É–∫–∞
            soundToggle.checked = database.settings.soundEnabled;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —è–∑—ã–∫–∞
            updateLanguageDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —è–∑—ã–∫–∞
        function updateLanguageDisplay() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            const languageValue = document.querySelector('#currentLanguageText');
            if (languageValue) {
                languageValue.textContent = database.settings.language === 'ru' ? '–†—É—Å—Å–∫–∏–π' : 'English';
            }
        }

        // –†–µ–Ω–¥–µ—Ä –æ–ø—Ü–∏–π —Ü–≤–µ—Ç–∞ –∞–≤–∞—Ç–∞—Ä–∞
        function renderAvatarColorOptions() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            avatarColors.innerHTML = '';
            avatarColorOptions.forEach((color, index) => {
                const colorOption = document.createElement('div');
                colorOption.className = 'avatar-color-option';
                colorOption.style.background = color.value;
                colorOption.title = color.name;
                colorOption.dataset.color = color.value;
                
                if (color.value === currentUser.avatarColor) {
                    colorOption.classList.add('selected');
                }
                
                colorOption.addEventListener('click', () => {
                    document.querySelectorAll('.avatar-color-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    colorOption.classList.add('selected');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    database.updateUser(currentUser.id, {
                        avatarColor: color.value
                    });
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    avatarPreview.style.background = color.value;
                    userAvatar.style.background = color.value;
                    profileModalAvatar.style.background = color.value;
                });
                
                avatarColors.appendChild(colorOption);
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function checkExistingUser() {
            initializeDemoData();
            
            const currentUserId = database.currentUserId;
            if (currentUserId) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
                const currentUser = database.getCurrentUser();
                if (currentUser) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                    translateInterface(database.settings.language);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    updateSettingsDisplay();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Premium —Å—Ç–∞—Ç—É—Å–∞
                    updatePremiumDisplay();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
                    updateProfileDisplay();
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    loadUserChats();
                    
                    showChatsScreen();
                } else {
                    showRegistrationScreen();
                }
            } else {
                // –ù—É–∂–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                showRegistrationScreen();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserChats() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            // –ü–æ–ª—É—á–∞–µ–º —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            const userChats = database.findUserChats(currentUser.id);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —á–∞—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            userChats.sort((a, b) => {
                return (b.lastMessageTime || b.updatedAt) - (a.lastMessageTime || a.updatedAt);
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∞—Ç—ã –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
            window.userChats = userChats;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegistrationScreen() {
            registrationScreen.style.display = 'flex';
            chatsScreen.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —á–∞—Ç–æ–≤
        function showChatsScreen() {
            registrationScreen.style.display = 'none';
            chatsScreen.style.display = 'flex';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è
            updateProfileDisplay();
            renderAvatarColorOptions();
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —á–∞—Ç—ã
            renderChats('');
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
        function renderChats(filter = '') {
            if (!window.userChats) return;
            
            chatList.innerHTML = '';
            
            const pinnedChats = window.userChats.filter(chat => chat.isPinned);
            const regularChats = window.userChats.filter(chat => !chat.isPinned);
            
            const filteredPinned = pinnedChats.filter(chat => 
                chat.name.toLowerCase().includes(filter.toLowerCase()) ||
                (chat.lastMessage && chat.lastMessage.toLowerCase().includes(filter.toLowerCase()))
            );
            
            const filteredRegular = regularChats.filter(chat => 
                chat.name.toLowerCase().includes(filter.toLowerCase()) ||
                (chat.lastMessage && chat.lastMessage.toLowerCase().includes(filter.toLowerCase()))
            );
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —á–∞—Ç—ã
            if (filteredPinned.length > 0) {
                const pinnedSection = document.createElement('div');
                pinnedSection.className = 'pinned-section';
                pinnedSection.innerHTML = '<div class="section-title" id="pinnedChatsTitle">' + 
                    (database.settings.language === 'ru' ? '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ' : 'Pinned') + '</div>';
                
                filteredPinned.forEach(chat => {
                    pinnedSection.appendChild(createChatItem(chat));
                });
                
                chatList.appendChild(pinnedSection);
                
                const allChatsTitle = document.createElement('div');
                allChatsTitle.className = 'section-title';
                allChatsTitle.textContent = database.settings.language === 'ru' ? '–í—Å–µ —á–∞—Ç—ã' : 'All chats';
                allChatsTitle.id = 'allChatsTitle';
                chatList.appendChild(allChatsTitle);
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –æ–±—ã—á–Ω—ã–µ —á–∞—Ç—ã
            filteredRegular.forEach(chat => {
                chatList.appendChild(createChatItem(chat));
            });
            
            // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            if (filteredPinned.length === 0 && filteredRegular.length === 0 && filter) {
                const noResults = document.createElement('div');
                noResults.className = 'no-results';
                noResults.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <span style="font-size: 48px; display: block; margin-bottom: 16px;">üîç</span>
                        <div style="color: #8e8e93; font-size: 16px;">${
                            database.settings.language === 'ru' ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : 'No results found'
                        }</div>
                    </div>
                `;
                chatList.appendChild(noResults);
            }
        }

        // –°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç —á–∞—Ç–∞
        function createChatItem(chat) {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.dataset.chatId = chat.id;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤
            let otherUser = null;
            if (chat.type === 'private' && chat.participants) {
                const currentUser = database.getCurrentUser();
                const otherUserId = chat.participants.find(id => id !== currentUser.id);
                if (otherUserId) {
                    otherUser = database.findUserById(otherUserId);
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
            const avatar = otherUser ? (otherUser.avatar || getAvatarInitial(otherUser.name)) : chat.avatar;
            const avatarColor = otherUser ? otherUser.avatarColor : chat.avatarColor;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–º—è
            const name = otherUser ? otherUser.name : chat.name;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const isOnline = otherUser ? otherUser.isOnline : false;
            const isPremium = otherUser ? otherUser.premium : false;
            
            const avatarClass = `avatar ${isOnline ? 'online' : ''} ${chat.isMuted ? 'muted' : ''} ${chat.type === 'group' ? 'group' : ''} ${isPremium ? 'premium-avatar' : ''}`;
            const unreadClass = chat.unreadCount > 0 ? 'unread' : '';
            
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è ID —á–∞—Ç–∞
            const chatIdElement = document.createElement('div');
            chatIdElement.className = 'chat-id-display';
            chatIdElement.textContent = `ID —á–∞—Ç–∞: ${chat.id}`;
            chatIdElement.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            
            chatItem.innerHTML = `
                <div class="${avatarClass}" style="background: ${avatarColor || avatarColorOptions[0].value}">
                    ${avatar}
                </div>
                <div class="chat-info">
                    <div class="chat-header">
                        <div class="chat-name">
                            ${name}
                            ${isPremium ? ' <span style="color: #FFD700; font-size: 12px;">‚≠ê</span>' : ''}
                        </div>
                        <div class="chat-time">${formatTime(chat.lastMessageTime)}</div>
                    </div>
                    <div class="last-message ${unreadClass}">
                        ${chat.isMuted ? 'üîá ' : ''}
                        ${chat.lastMessage || ''}
                    </div>
                </div>
                <div class="chat-meta">
                    ${chat.unreadCount > 0 ? `<div class="unread-badge">${chat.unreadCount}</div>` : ''}
                    ${chat.isPinned ? '<div class="pinned-indicator">üìç</div>' : ''}
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å ID —á–∞—Ç–∞
            const chatInfo = chatItem.querySelector('.chat-info');
            chatInfo.appendChild(chatIdElement);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ ID
            let longPressTimer;
            chatItem.addEventListener('touchstart', function(e) {
                longPressTimer = setTimeout(() => {
                    showChatId(chat.id, chatItem);
                }, 1000);
                e.preventDefault();
            });
            
            chatItem.addEventListener('touchend', function() {
                clearTimeout(longPressTimer);
            });
            
            chatItem.addEventListener('touchmove', function() {
                clearTimeout(longPressTimer);
            });
            
            chatItem.addEventListener('mousedown', function(e) {
                if (e.button === 0) { // –õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏
                    longPressTimer = setTimeout(() => {
                        showChatId(chat.id, chatItem);
                    }, 1000);
                }
            });
            
            chatItem.addEventListener('mouseup', function() {
                clearTimeout(longPressTimer);
            });
            
            chatItem.addEventListener('click', function(e) {
                clearTimeout(longPressTimer);
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –ø–æ–∫–∞–∑–∞–Ω ID, –µ—Å–ª–∏ –¥–∞ - —Å–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                if (chatIdElement.style.display === 'block') {
                    chatIdElement.style.display = 'none';
                    return;
                }
                openChat(chat.id);
            });
            
            return chatItem;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å ID —á–∞—Ç–∞
        function showChatId(chatId, chatItem) {
            const chatIdElement = chatItem.querySelector('.chat-id-display');
            if (chatIdElement) {
                chatIdElement.style.display = 'block';
                chatIdElement.style.animation = 'fadeIn 0.3s ease-out';
                
                // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    chatIdElement.style.display = 'none';
                }, 3000);
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(timestamp) {
            if (!timestamp) return '';
            
            const now = Date.now();
            const diff = now - timestamp;
            const date = new Date(timestamp);
            
            // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è
            if (isToday(timestamp)) {
                return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            }
            
            // –ï—Å–ª–∏ –≤—á–µ—Ä–∞
            if (isYesterday(timestamp)) {
                return database.settings.language === 'ru' ? '–≤—á–µ—Ä–∞' : 'yesterday';
            }
            
            // –ï—Å–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏
            if (diff < 7 * 24 * 60 * 60 * 1000) {
                const days = ['–≤—Å', '–ø–Ω', '–≤—Ç', '—Å—Ä', '—á—Ç', '–ø—Ç', '—Å–±'];
                return database.settings.language === 'ru' ? days[date.getDay()] : 
                    ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][date.getDay()];
            }
            
            // –ë–æ–ª–µ–µ –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥
            return `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}`;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–µ–≥–æ–¥–Ω—è –ª–∏ –¥–∞—Ç–∞
        function isToday(timestamp) {
            const today = new Date();
            const date = new Date(timestamp);
            return date.getDate() === today.getDate() &&
                   date.getMonth() === today.getMonth() &&
                   date.getFullYear() === today.getFullYear();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—á–µ—Ä–∞ –ª–∏ –¥–∞—Ç–∞
        function isYesterday(timestamp) {
            const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000);
            const date = new Date(timestamp);
            return date.getDate() === yesterday.getDate() &&
                   date.getMonth() === yesterday.getMonth() &&
                   date.getFullYear() === yesterday.getFullYear();
        }

        // –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
        function openChat(chatId) {
            const chat = database.findChatById(chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤
            let otherUser = null;
            if (chat.type === 'private' && chat.participants) {
                const currentUser = database.getCurrentUser();
                const otherUserId = chat.participants.find(id => id !== currentUser.id);
                if (otherUserId) {
                    otherUser = database.findUserById(otherUserId);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            currentChatName.textContent = otherUser ? otherUser.name : chat.name;
            
            if (otherUser) {
                currentChatAvatar.innerHTML = otherUser.avatar || getAvatarInitial(otherUser.name);
                currentChatAvatar.style.background = otherUser.avatarColor || avatarColorOptions[0].value;
                
                const lang = translations[database.settings.language];
                currentChatStatus.textContent = otherUser.isOnline ? lang.onlineStatus : lang.recentlyOnline;
                
                if (otherUser.premium) {
                    currentChatAvatar.classList.add('premium-avatar');
                } else {
                    currentChatAvatar.classList.remove('premium-avatar');
                }
            } else {
                currentChatAvatar.innerHTML = chat.avatar;
                currentChatAvatar.style.background = chat.avatarColor || avatarColorOptions[0].value;
                
                const lang = translations[database.settings.language];
                currentChatStatus.textContent = lang.recentlyOnline;
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è
            renderMessages(chat.messages || []);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (chat.unreadCount > 0) {
                database.updateChat(chatId, {
                    unreadCount: 0
                });
                loadUserChats();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —á–∞—Ç–∞
            chatsScreen.style.display = 'none';
            document.getElementById('chatScreen').style.display = 'flex';
            
            setTimeout(() => {
                messageInput.focus();
            }, 100);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            renderChats(searchInput.value);
        }

        // –†–µ–Ω–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
        function renderMessages(messages) {
            const lang = translations[database.settings.language];
            
            messagesContainer.innerHTML = `
                <div class="message-date">
                    <span id="todayLabel">${lang.todayLabel}</span>
                </div>
            `;
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                const currentUser = database.getCurrentUser();
                const isOutgoing = msg.senderId === currentUser.id;
                
                messageDiv.className = `message ${isOutgoing ? 'outgoing' : 'incoming'}`;
                
                let messageContent = '';
                if (msg.senderName && !isOutgoing) {
                    messageContent += `<div class="message-sender">${msg.senderName}</div>`;
                }
                messageContent += `<div class="message-text">${msg.text}</div>`;
                
                const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const timeHtml = isOutgoing ? 
                    `<span class="message-time">${time}</span><span class="message-status read">‚úì‚úì</span>` :
                    `<span class="message-time">${time}</span>`;
                
                messageDiv.innerHTML = `
                    ${messageContent}
                    <div class="message-meta">
                        ${timeHtml}
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
            });
            
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || !currentChatId) return;
            
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            database.addMessageToChat(currentChatId, {
                senderId: currentUser.id,
                text: text,
                isRead: false
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç
            const chat = database.findChatById(currentChatId);
            if (chat) {
                chat.lastMessage = text;
                chat.lastMessageTime = Date.now();
                database.saveChats();
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const messages = chat ? chat.messages : [];
            renderMessages(messages);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            messageInput.value = '';
            updateSendButton();
            messageInput.style.height = 'auto';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            loadUserChats();
            renderChats(searchInput.value);
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤)
            if (chat && chat.type === 'private') {
                setTimeout(() => {
                    const replies = database.settings.language === 'ru' ? [
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ!",
                        "–ü–æ–Ω—è–ª(–∞)",
                        "–°–æ–≥–ª–∞—Å–µ–Ω(–∞)",
                        "–•–æ—Ä–æ—à–æ",
                        "–°–ø–∞—Å–∏–±–æ!",
                        "–û—Ç–ª–∏—á–Ω–æ!"
                    ] : [
                        "Interesting!",
                        "Got it",
                        "Agree",
                        "Good",
                        "Thanks!",
                        "Excellent!"
                    ];
                    
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    const otherUserId = chat.participants.find(id => id !== currentUser.id);
                    
                    if (otherUserId) {
                        database.addMessageToChat(currentChatId, {
                            senderId: otherUserId,
                            text: randomReply,
                            isRead: false
                        });
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç
                        chat.lastMessage = randomReply;
                        chat.lastMessageTime = Date.now();
                        chat.unreadCount = (chat.unreadCount || 0) + 1;
                        database.saveChats();
                        
                        // –†–µ–Ω–¥–µ—Ä–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è
                        const updatedMessages = chat.messages;
                        renderMessages(updatedMessages);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                        loadUserChats();
                        renderChats(searchInput.value);
                    }
                }, Math.random() * 1000 + 1000);
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        function updateSendButton() {
            sendButton.disabled = messageInput.value.trim() === '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function initRegistration() {
            setTimeout(() => {
                phoneInput.focus();
            }, 500);

            phoneInput.addEventListener('input', function(e) {
                let value = this.value;
                
                if (value.startsWith('+')) {
                    value = '+' + value.substring(1).replace(/\D/g, '');
                } else {
                    value = value.replace(/\D/g, '');
                }
                
                if (value.startsWith('+')) {
                    if (value.length > 12) value = value.substring(0, 12);
                } else {
                    if (value.length > 11) value = value.substring(0, 11);
                }
                
                this.value = value;
                continueButton.disabled = !isValidPhoneNumber(value);
            });

            continueButton.addEventListener('click', function() {
                const phoneValue = phoneInput.value;
                
                if (!isValidPhoneNumber(phoneValue)) {
                    const lang = translations[database.settings.language];
                    showNotification(lang.phoneError);
                    phoneInput.focus();
                    return;
                }
                
                const formattedPhone = formatPhoneNumber(phoneValue);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º
                const existingUser = database.findUserByPhone(formattedPhone);
                
                if (existingUser) {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤—Ö–æ–¥–∏–º –≤ –∞–∫–∫–∞—É–Ω—Ç
                    database.setCurrentUser(existingUser.id);
                    database.updateUser(existingUser.id, {
                        isOnline: true,
                        lastSeen: Date.now()
                    });
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const newUser = database.addUser({
                        name: database.settings.language === 'ru' ? "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" : "New user",
                        username: database.generateUniqueUsername("user"),
                        phone: formattedPhone,
                        avatar: "–ù",
                        avatarColor: avatarColorOptions[0].value,
                        isOnline: true,
                        premium: false,
                        bio: database.settings.language === 'ru' ? "–ü—Ä–∏–≤–µ—Ç! –Ø –∏—Å–ø–æ–ª—å–∑—É—é Svift" : "Hello! I'm using Svift"
                    });
                    
                    database.setCurrentUser(newUser.id);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                database.saveSettings();
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                loadUserChats();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —á–∞—Ç–æ–≤
                showChatsScreen();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                setTimeout(() => {
                    const lang = translations[database.settings.language];
                    showNotification(lang.welcomeMessage);
                }, 500);
            });

            phoneInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (!continueButton.disabled) {
                        continueButton.click();
                    }
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
        function initCreateChannel() {
            newChatButton.addEventListener('click', function() {
                createChannelModal.style.display = 'flex';
                resetChannelCreation();
                updateChannelButtons();
            });

            closeCreateChannelModal.addEventListener('click', function() {
                createChannelModal.style.display = 'none';
            });

            createChannelModal.addEventListener('click', function(e) {
                if (e.target === createChannelModal) {
                    createChannelModal.style.display = 'none';
                }
            });

            // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–∞–Ω–∞–ª–∞
            channelTypeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    channelTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    channelData.type = this.dataset.type;
                    
                    if (channelData.type === 'chat') {
                        channelData.privacy = 'private';
                        privacyOptions.forEach(opt => opt.classList.remove('selected'));
                        document.querySelector('.privacy-option[data-privacy="private"]').classList.add('selected');
                    }
                    
                    updateChannelButtons();
                });
            });

            channelNameInput.addEventListener('input', function() {
                channelData.name = this.value.trim();
                updateChannelButtons();
            });

            privacyOptions.forEach(option => {
                option.addEventListener('click', function() {
                    privacyOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    channelData.privacy = this.dataset.privacy;
                    updateChannelButtons();
                });
            });

            channelLinkInput.addEventListener('input', function() {
                channelData.link = this.value.trim().toLowerCase();
                updateChannelButtons();
            });

            channelBackButton.addEventListener('click', function() {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                    updateChannelButtons();
                }
            });

            channelNextButton.addEventListener('click', function() {
                if (currentStep < 5) {
                    if (!validateCurrentStep()) {
                        return;
                    }
                    
                    if (currentStep === 3 && channelData.privacy !== 'public') {
                        currentStep = 5;
                    } else {
                        currentStep++;
                    }
                    
                    if (currentStep === 5) {
                        updateSummary();
                    }
                    
                    showStep(currentStep);
                    updateChannelButtons();
                } else if (currentStep === 5) {
                    createChannel();
                }
            });

            channelNameInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && currentStep === 2) {
                    e.preventDefault();
                    if (validateCurrentStep()) {
                        channelNextButton.click();
                    }
                }
            });

            channelLinkInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && currentStep === 4) {
                    e.preventDefault();
                    if (validateCurrentStep()) {
                        channelNextButton.click();
                    }
                }
            });
        }

        // –°–±—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
        function resetChannelCreation() {
            currentStep = 1;
            channelData = {
                type: 'chat',
                name: '',
                privacy: 'private',
                link: ''
            };
            
            channelTypeOptions.forEach(opt => opt.classList.remove('selected'));
            document.querySelector('.channel-type-option[data-type="chat"]').classList.add('selected');
            
            privacyOptions.forEach(opt => opt.classList.remove('selected'));
            document.querySelector('.privacy-option[data-privacy="private"]').classList.add('selected');
            
            channelNameInput.value = '';
            channelLinkInput.value = '';
            
            showStep(1);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —à–∞–≥
        function showStep(step) {
            [step1, step2, step3, step4, step5].forEach((s, index) => {
                if (index + 1 === step) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
        function validateCurrentStep() {
            const lang = translations[database.settings.language];
            
            if (currentStep === 2) {
                if (!channelData.name) {
                    showNotification(lang.channelNameError);
                    channelNameInput.focus();
                    return false;
                }
            } else if (currentStep === 4) {
                if (!channelData.link) {
                    showNotification(lang.channelLinkError);
                    channelLinkInput.focus();
                    return false;
                }
                
                const linkRegex = /^[a-z0-9_]+$/;
                if (!linkRegex.test(channelData.link)) {
                    showNotification(lang.channelLinkError);
                    channelLinkInput.focus();
                    return false;
                }
                
                const existingUser = database.findUserByUsername(channelData.link);
                if (existingUser) {
                    showNotification(lang.channelLinkTakenError);
                    channelLinkInput.focus();
                    return false;
                }
            }
            
            return true;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateChannelButtons() {
            const lang = translations[database.settings.language];
            
            channelBackButton.disabled = currentStep === 1;
            
            if (currentStep < 5) {
                channelNextButton.textContent = lang.channelNextText;
                channelNextButton.className = 'channel-button next';
                
                if (currentStep === 1) {
                    channelNextButton.disabled = false;
                } else if (currentStep === 2) {
                    channelNextButton.disabled = !channelData.name.trim();
                } else if (currentStep === 3) {
                    channelNextButton.disabled = false;
                } else if (currentStep === 4) {
                    channelNextButton.disabled = !channelData.link.trim() || 
                        !/^[a-z0-9_]+$/.test(channelData.link);
                }
            } else {
                channelNextButton.textContent = lang.channelCreateText;
                channelNextButton.className = 'channel-button create';
                channelNextButton.disabled = false;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏
        function updateSummary() {
            const lang = translations[database.settings.language];
            
            summaryType.textContent = lang.summaryType + ' ' + 
                (channelData.type === 'chat' ? lang.chatTypeName : lang.channelTypeName);
            
            summaryName.textContent = lang.summaryName + ' ' + channelData.name;
            
            summaryPrivacy.textContent = lang.summaryPrivacy + ' ' + 
                (channelData.privacy === 'private' ? lang.privatePrivacyName : lang.publicPrivacyName);
            
            if (channelData.privacy === 'public' && channelData.link) {
                summaryLink.textContent = lang.summaryLink + ' svift.me/' + channelData.link;
            } else {
                summaryLink.textContent = lang.summaryLink + ' -';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
        function createChannel() {
            const lang = translations[database.settings.language];
            
            channelNextButton.textContent = lang.channelCreatingText;
            channelNextButton.disabled = true;
            
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            const newChat = database.addChat({
                name: channelData.name,
                type: channelData.type,
                participants: [currentUser.id],
                lastMessage: database.settings.language === 'ru' ? "–ö–∞–Ω–∞–ª —Å–æ–∑–¥–∞–Ω" : "Channel created",
                lastMessageTime: Date.now(),
                unreadCount: 0,
                isPinned: false,
                isMuted: false,
                avatar: channelData.type === 'chat' ? 'üí¨' : 'üì¢',
                avatarColor: avatarColorOptions[0].value,
                messages: [
                    {
                        senderId: currentUser.id,
                        text: database.settings.language === 'ru' ? 
                            `–ö–∞–Ω–∞–ª "${channelData.name}" —Å–æ–∑–¥–∞–Ω. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!` :
                            `Channel "${channelData.name}" created. Welcome!`,
                        timestamp: Date.now(),
                        isRead: true
                    }
                ]
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            loadUserChats();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            setTimeout(() => {
                createChannelModal.style.display = 'none';
                channelNextButton.textContent = lang.channelCreateText;
                channelNextButton.disabled = false;
                
                showNotification(lang.channelCreatedMessage);
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —á–∞—Ç
                setTimeout(() => {
                    openChat(newChat.id);
                }, 500);
            }, 1000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function initSearchUsers() {
            searchUsernameButton.addEventListener('click', function() {
                searchUsersModal.style.display = 'flex';
                searchUsersInput.value = '';
                searchUsersResults.innerHTML = `
                    <div class="no-users-found">
                        <span class="no-users-found-icon">üîç</span>
                        <div class="no-users-found-text">${
                            database.settings.language === 'ru' ? '–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π' : 'Start searching users'
                        }</div>
                    </div>
                `;
                renderSearchHistory();
                setTimeout(() => {
                    searchUsersInput.focus();
                }, 300);
            });

            closeSearchUsersModal.addEventListener('click', function() {
                searchUsersModal.style.display = 'none';
            });

            searchUsersModal.addEventListener('click', function(e) {
                if (e.target === searchUsersModal) {
                    searchUsersModal.style.display = 'none';
                }
            });

            let searchTimeout;
            searchUsersInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const query = this.value.trim().toLowerCase();
                
                if (query.length === 0) {
                    searchUsersResults.innerHTML = `
                        <div class="no-users-found">
                            <span class="no-users-found-icon">üîç</span>
                            <div class="no-users-found-text">${
                                database.settings.language === 'ru' ? '–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π' : 'Start searching users'
                            }</div>
                        </div>
                    `;
                    return;
                }
                
                if (query.length < 2) {
                    return;
                }
                
                searchUsersResults.innerHTML = `
                    <div class="search-users-loading">
                        <span class="search-users-loading-icon">‚ö°</span>
                        <div class="search-users-loading-text">${
                            database.settings.language === 'ru' ? '–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...' : 'Searching users...'
                        }</div>
                    </div>
                `;
                
                searchTimeout = setTimeout(() => {
                    searchUsers(query);
                }, 500);
            });

            searchUsersInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = this.value.trim().toLowerCase();
                    if (query.length >= 2) {
                        searchUsers(query);
                    }
                }
            });
        }

        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function searchUsers(query) {
            const lang = translations[database.settings.language];
            const results = database.searchUsers(query);

            if (results.length === 0) {
                searchUsersResults.innerHTML = `
                    <div class="no-users-found">
                        <span class="no-users-found-icon">üòï</span>
                        <div class="no-users-found-text">${lang.noUsersFound}</div>
                    </div>
                `;
            } else {
                let resultsHTML = `
                    <div style="margin-bottom: 16px; color: #8e8e93; font-size: 14px; font-weight: 500;">
                        ${lang.searchResult} "${query}"
                    </div>
                `;
                
                results.forEach(user => {
                    const statusClass = user.isOnline ? 'online' : '';
                    const statusText = user.isOnline ? lang.userOnline : lang.userOffline;
                    const premiumBadge = user.premium ? ' <span style="color: #FFD700; font-size: 12px;">‚≠ê</span>' : '';
                    
                    resultsHTML += `
                        <div class="search-user-item" data-user-id="${user.id}">
                            <div class="search-user-avatar" style="background: ${user.avatarColor || avatarColorOptions[0].value}">
                                ${user.avatar || getAvatarInitial(user.name)}
                            </div>
                            <div class="search-user-info">
                                <div class="search-user-name">
                                    ${user.name}${premiumBadge}
                                </div>
                                <div class="search-user-username">
                                    @${user.username || ''}
                                </div>
                                <div class="search-user-id">
                                    ID: ${user.id}
                                </div>
                                <div class="search-user-status ${statusClass}">
                                    ${statusText}
                                </div>
                            </div>
                            <button class="search-user-start-chat" data-user-id="${user.id}">
                                ${lang.startChat}
                            </button>
                        </div>
                    `;
                });
                
                searchUsersResults.innerHTML = resultsHTML;
                
                document.querySelectorAll('.search-user-start-chat').forEach(button => {
                    button.addEventListener('click', function() {
                        const userId = parseInt(this.dataset.userId);
                        startChatWithUser(userId);
                    });
                });
                
                document.querySelectorAll('.search-user-item').forEach(item => {
                    item.addEventListener('click', function(e) {
                        if (!e.target.classList.contains('search-user-start-chat')) {
                            const userId = parseInt(this.dataset.userId);
                            startChatWithUser(userId);
                        }
                    });
                });
                
                database.addToSearchHistory(query, results.map(user => user.id));
            }
        }

        // –ù–∞—á–∞—Ç—å —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        function startChatWithUser(userId) {
            const user = database.findUserById(userId);
            if (!user) return;
            
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —á–∞—Ç —Å —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            const existingChats = database.findUserChats(currentUser.id);
            const existingChat = existingChats.find(chat => 
                chat.type === 'private' && 
                chat.participants && 
                chat.participants.includes(userId)
            );
            
            if (existingChat) {
                openChat(existingChat.id);
            } else {
                const newChat = database.addChat({
                    name: user.name,
                    type: 'private',
                    participants: [currentUser.id, userId],
                    lastMessage: database.settings.language === 'ru' ? "–ß–∞—Ç —Å–æ–∑–¥–∞–Ω" : "Chat created",
                    lastMessageTime: Date.now(),
                    unreadCount: 0,
                    isPinned: false,
                    isMuted: false,
                    avatar: user.avatar || getAvatarInitial(user.name),
                    avatarColor: user.avatarColor || avatarColorOptions[0].value,
                    messages: [
                        {
                            senderId: currentUser.id,
                            text: database.settings.language === 'ru' ? 
                                `–í—ã –Ω–∞—á–∞–ª–∏ –¥–∏–∞–ª–æ–≥ —Å ${user.name}` :
                                `You started a conversation with ${user.name}`,
                            timestamp: Date.now(),
                            isRead: true
                        }
                    ]
                });
                
                loadUserChats();
                renderChats('');
                openChat(newChat.id);
                
                showNotification(
                    database.settings.language === 'ru' ? 
                    `‚úÖ –ß–∞—Ç —Å ${user.name} —Å–æ–∑–¥–∞–Ω` :
                    `‚úÖ Chat with ${user.name} created`
                );
            }
            
            searchUsersModal.style.display = 'none';
        }

        // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
        function renderSearchHistory() {
            const lang = translations[database.settings.language];
            const searchHistory = database.searchHistory;
            
            if (searchHistory.length === 0) {
                searchHistorySection.innerHTML = '';
                return;
            }
            
            let historyHTML = `
                <div class="search-history-title">${lang.searchHistoryTitle}</div>
            `;
            
            searchHistory.forEach(item => {
                const historyUsers = item.results.map(userId => 
                    database.findUserById(userId)
                ).filter(user => user);
                
                if (historyUsers.length === 0) return;
                
                const firstUser = historyUsers[0];
                const otherCount = historyUsers.length - 1;
                const timeAgo = formatTimeAgo(item.timestamp);
                
                historyHTML += `
                    <div class="search-history-item" data-query="${item.query}">
                        <div class="search-history-avatar" style="background: ${firstUser.avatarColor || avatarColorOptions[0].value}">
                            ${firstUser.avatar || getAvatarInitial(firstUser.name)}
                        </div>
                        <div class="search-history-info">
                            <div class="search-history-name">
                                ${item.query}
                            </div>
                            <div class="search-history-username">
                                ${firstUser.name} (ID: ${firstUser.id})
                                ${otherCount > 0 ? ` +${otherCount} ${database.settings.language === 'ru' ? (otherCount === 1 ? '–¥—Ä—É–≥–æ–π' : '–¥—Ä—É–≥–∏—Ö') : (otherCount === 1 ? 'other' : 'others')}` : ''}
                            </div>
                            <div class="search-history-time">
                                ${timeAgo}
                            </div>
                        </div>
                        <button class="search-history-clear" data-query="${item.query}">
                            ‚úï
                        </button>
                    </div>
                `;
            });
            
            historyHTML += `
                <div style="text-align: center; margin-top: 12px;">
                    <button class="search-history-clear" id="clearAllHistory" style="width: 100%;">
                        ${lang.clearHistory}
                    </button>
                </div>
            `;
            
            searchHistorySection.innerHTML = historyHTML;
            
            document.querySelectorAll('.search-history-item').forEach(item => {
                item.addEventListener('click', function() {
                    const query = this.dataset.query;
                    searchUsersInput.value = query;
                    searchUsers(query);
                });
            });
            
            document.querySelectorAll('.search-history-clear:not(#clearAllHistory)').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const query = this.dataset.query;
                    database.searchHistory = database.searchHistory.filter(item => item.query !== query);
                    database.saveSearchHistory();
                    renderSearchHistory();
                });
            });
            
            const clearAllBtn = document.getElementById('clearAllHistory');
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', function() {
                    database.clearSearchHistory();
                    renderSearchHistory();
                    showNotification(
                        database.settings.language === 'ru' ? 
                        '–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ –æ—á–∏—â–µ–Ω–∞' : 
                        'Search history cleared'
                    );
                });
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–∑–∞–¥
        function formatTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const lang = translations[database.settings.language];
            
            const minute = 60 * 1000;
            const hour = 60 * minute;
            const day = 24 * hour;
            
            if (diff < minute) {
                return database.settings.language === 'ru' ? '—Ç–æ–ª—å–∫–æ —á—Ç–æ' : 'just now';
            } else if (diff < hour) {
                const minutes = Math.floor(diff / minute);
                return database.settings.language === 'ru' ? `${minutes} –º–∏–Ω. –Ω–∞–∑–∞–¥` : `${minutes} min ago`;
            } else if (diff < day) {
                const hours = Math.floor(diff / hour);
                return database.settings.language === 'ru' ? `${hours} —á. –Ω–∞–∑–∞–¥` : `${hours} hours ago`;
            } else {
                const days = Math.floor(diff / day);
                return database.settings.language === 'ru' ? `${days} –¥–Ω. –Ω–∞–∑–∞–¥` : `${days} days ago`;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        profileButton.addEventListener('click', function() {
            profileModal.style.display = 'flex';
            updateProfileDisplay();
        });

        profileModal.addEventListener('click', function(e) {
            if (e.target === profileModal) {
                profileModal.style.display = 'none';
            }
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ Svift Premium
        premiumMenuItem.addEventListener('click', function() {
            profileModal.style.display = 'none';
            premiumModal.style.display = 'flex';
        });

        closePremiumModal.addEventListener('click', function() {
            premiumModal.style.display = 'none';
        });

        premiumModal.addEventListener('click', function(e) {
            if (e.target === premiumModal) {
                premiumModal.style.display = 'none';
            }
        });

        // –ü–æ–∫—É–ø–∫–∞ Premium
        buyPremiumButton.addEventListener('click', function() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            if (!currentUser.premium) {
                database.updateUser(currentUser.id, {
                    premium: true
                });
                
                updatePremiumDisplay();
                premiumModal.style.display = 'none';
                
                const lang = translations[database.settings.language];
                showNotification(lang.premiumActivated);
                
                buyPremiumButton.style.animation = 'pulse 0.5s';
                setTimeout(() => {
                    buyPremiumButton.style.animation = '';
                }, 500);
            } else {
                const lang = translations[database.settings.language];
                showNotification(lang.alreadyPremium);
            }
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
        editProfileMenuItem.addEventListener('click', function() {
            profileModal.style.display = 'none';
            editProfileModal.style.display = 'flex';
            
            setTimeout(() => {
                const modalContent = document.querySelector('.edit-profile-modal-content');
                if (modalContent) {
                    modalContent.scrollTop = 0;
                }
                editNameInput.focus();
            }, 300);
        });

        closeEditProfileModal.addEventListener('click', function() {
            editProfileModal.style.display = 'none';
        });

        editProfileModal.addEventListener('click', function(e) {
            if (e.target === editProfileModal) {
                editProfileModal.style.display = 'none';
            }
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        saveProfileButton.addEventListener('click', function() {
            const currentUser = database.getCurrentUser();
            if (!currentUser) return;
            
            const name = editNameInput.value.trim();
            const username = editUsernameInput.value.trim().replace('@', '');
            
            const lang = translations[database.settings.language];
            
            if (!name) {
                showNotification(lang.phoneError.replace('–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', '–∏–º—è'));
                editNameInput.focus();
                return;
            }
            
            if (username) {
                if (username.length < 3) {
                    showNotification(lang.phoneError.replace('–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', '—é–∑–µ—Ä–Ω–µ–π–º (–º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞)'));
                    editUsernameInput.focus();
                    return;
                }
                
                const usernameRegex = /^[a-zA-Z0-9_]+$/;
                if (!usernameRegex.test(username)) {
                    showNotification(lang.phoneError.replace('–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', '—é–∑–µ—Ä–Ω–µ–π–º (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _)'));
                    editUsernameInput.focus();
                    return;
                }
                
                if (database.isUsernameTaken(username, currentUser.id)) {
                    showNotification(lang.phoneError.replace('–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', '—é–∑–µ—Ä–Ω–µ–π–º (—É–∂–µ –∑–∞–Ω—è—Ç)'));
                    editUsernameInput.focus();
                    return;
                }
            }
            
            const avatarInitial = getAvatarInitial(name);
            
            database.updateUser(currentUser.id, {
                name: name,
                username: username,
                avatar: avatarInitial
            });
            
            updateProfileDisplay();
            editProfileModal.style.display = 'none';
            showNotification(lang.profileUpdated);
            
            saveProfileButton.style.animation = 'pulse 0.5s';
            setTimeout(() => {
                saveProfileButton.style.animation = '';
            }, 500);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏
        editNameInput.addEventListener('input', function() {
            const name = this.value.trim();
            if (name) {
                const initial = getAvatarInitial(name);
                avatarPreview.textContent = initial;
                const currentUser = database.getCurrentUser();
                if (currentUser) {
                    userAvatar.textContent = initial;
                    profileModalAvatar.textContent = initial;
                }
            }
        });

        // –ö–Ω–æ–ø–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –∞–≤–∞—Ç–∞—Ä–∞
        changeAvatarButton.addEventListener('click', function() {
            const colorsSection = document.getElementById('avatarColors');
            if (colorsSection) {
                const modalContent = document.querySelector('.edit-profile-modal-content');
                const colorsTop = colorsSection.offsetTop;
                
                modalContent.scrollTo({
                    top: colorsTop - 20,
                    behavior: 'smooth'
                });
                
                document.querySelectorAll('.avatar-color-option').forEach(option => {
                    option.style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        option.style.animation = '';
                    }, 500);
                });
            }
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
        privacyMenuItem.addEventListener('click', function() {
            profileModal.style.display = 'none';
            privacyModal.style.display = 'flex';
            updateSettingsDisplay();
            
            const privacyOption = document.querySelector('.settings-option');
            if (privacyOption) {
                privacyOption.addEventListener('click', function() {
                    const options = ['all', 'contacts', 'nobody'];
                    const currentIndex = options.indexOf(database.settings.lastSeen);
                    const nextIndex = (currentIndex + 1) % options.length;
                    database.settings.lastSeen = options[nextIndex];
                    database.saveSettings();
                    
                    updateSettingsDisplay();
                    
                    const messages = translations[database.settings.language];
                    const notificationMessages = {
                        'all': messages.lastSeenAllMessage,
                        'contacts': messages.lastSeenContactsMessage,
                        'nobody': messages.lastSeenNobodyMessage
                    };
                    showNotification(notificationMessages[database.settings.lastSeen]);
                });
            }
        });

        closePrivacyModal.addEventListener('click', function() {
            privacyModal.style.display = 'none';
        });

        privacyModal.addEventListener('click', function(e) {
            if (e.target === privacyModal) {
                privacyModal.style.display = 'none';
            }
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        notificationsMenuItem.addEventListener('click', function() {
            profileModal.style.display = 'none';
            notificationsModal.style.display = 'flex';
            soundToggle.checked = database.settings.soundEnabled;
            
            soundToggle.addEventListener('change', function() {
                database.settings.soundEnabled = this.checked;
                database.saveSettings();
                
                const lang = translations[database.settings.language];
                if (database.settings.soundEnabled) {
                    showNotification(lang.soundOn);
                } else {
                    showNotification(lang.soundOff);
                }
            });
        });

        closeNotificationsModal.addEventListener('click', function() {
            notificationsModal.style.display = 'none';
        });

        notificationsModal.addEventListener('click', function(e) {
            if (e.target === notificationsModal) {
                notificationsModal.style.display = 'none';
            }
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —è–∑—ã–∫–∞
        languageMenuItem.addEventListener('click', function() {
            profileModal.style.display = 'none';
            languageModal.style.display = 'flex';
            
            document.querySelectorAll('.settings-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            if (database.settings.language === 'ru') {
                if (languageOptionRu) languageOptionRu.classList.add('selected');
            } else {
                if (languageOptionEn) languageOptionEn.classList.add('selected');
            }
        });

        closeLanguageModal.addEventListener('click', function() {
            languageModal.style.display = 'none';
        });

        languageModal.addEventListener('click', function(e) {
            if (e.target === languageModal) {
                languageModal.style.display = 'none';
            }
        });

        // –í—ã–±–æ—Ä —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        if (languageOptionRu) {
            languageOptionRu.addEventListener('click', function() {
                if (database.settings.language !== 'ru') {
                    database.settings.language = 'ru';
                    database.saveSettings();
                    translateInterface('ru');
                    updateLanguageDisplay();
                    updateSettingsDisplay();
                    
                    const lang = translations['ru'];
                    showNotification(lang.languageChangedRu);
                    closeLanguageModal.click();
                }
            });
        }

        // –í—ã–±–æ—Ä –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
        if (languageOptionEn) {
            languageOptionEn.addEventListener('click', function() {
                if (database.settings.language !== 'en') {
                    database.settings.language = 'en';
                    database.saveSettings();
                    translateInterface('en');
                    updateLanguageDisplay();
                    updateSettingsDisplay();
                    
                    const lang = translations['en'];
                    showNotification(lang.languageChangedEn);
                    closeLanguageModal.click();
                }
            });
        }

        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        logoutButton.addEventListener('click', function() {
            const lang = translations[database.settings.language];
            if (confirm(lang.logoutConfirm)) {
                const currentUser = database.getCurrentUser();
                if (currentUser) {
                    database.updateUser(currentUser.id, {
                        isOnline: false,
                        lastSeen: Date.now()
                    });
                }
                
                database.setCurrentUser(null);
                database.saveSettings();
                
                showNotification(lang.loggedOut);
                profileModal.style.display = 'none';
                
                setTimeout(() => {
                    showRegistrationScreen();
                    phoneInput.value = '';
                    continueButton.disabled = true;
                }, 1000);
            }
        });

        // –ö–ª–∏–∫ –Ω–∞ –∞–≤–∞—Ç–∞—Ä –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        if (profileModalAvatar) {
            profileModalAvatar.addEventListener('click', function() {
                profileModal.style.display = 'none';
                editProfileModal.style.display = 'flex';
            });
        }

        if (profileModalName) {
            profileModalName.addEventListener('click', function() {
                profileModal.style.display = 'none';
                editProfileModal.style.display = 'flex';
            });
        }

        if (profileModalUsername) {
            profileModalUsername.addEventListener('click', function() {
                profileModal.style.display = 'none';
                editProfileModal.style.display = 'flex';
            });
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        backButton.addEventListener('click', function() {
            document.getElementById('chatScreen').style.display = 'none';
            chatsScreen.style.display = 'flex';
            currentChatId = null;
            renderChats(searchInput.value);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        sendButton.addEventListener('click', sendMessage);

        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        messageInput.addEventListener('input', function() {
            updateSendButton();
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // –ü–æ–∏—Å–∫ –≤ —á–∞—Ç–∞—Ö
        searchInput.addEventListener('input', function() {
            renderChats(this.value);
        });

        // –ö–Ω–æ–ø–∫–∏ –≤–≤–æ–¥–∞
        document.getElementById('attachButton').addEventListener('click', function() {
            const lang = translations[database.settings.language];
            showNotification(lang.attachFunction);
        });

        document.getElementById('emojiButton').addEventListener('click', function() {
            const lang = translations[database.settings.language];
            showNotification(lang.emojiFunction);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            checkExistingUser();
            initRegistration();
            initCreateChannel();
            initSearchUsers();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                    100% { transform: scale(1); }
                }
                @keyframes slideUp {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .settings-option.selected {
                    background: rgba(0, 122, 255, 0.1);
                }
                .settings-option.selected .settings-option-label {
                    color: #007aff;
                    font-weight: 600;
                }
                .no-results {
                    text-align: center;
                    padding: 60px 20px;
                    color: #8e8e93;
                }
            `;
            document.head.appendChild(style);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            document.addEventListener('touchstart', function(event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            }, { passive: false });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('gesturechange', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('gestureend', function(e) {
                e.preventDefault();
            });
            
            if (messageInput) {
                messageInput.addEventListener('focus', function() {
                    setTimeout(() => {
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, 300);
                });
            }
            
            window.addEventListener('resize', function() {
                if (document.activeElement === messageInput) {
                    setTimeout(() => {
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, 100);
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é —á–∞—Ç–∞
            document.getElementById('chatMenuButton').addEventListener('click', function() {
                const lang = translations[database.settings.language];
                showNotification('üì± –ú–µ–Ω—é —á–∞—Ç–∞ (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            });
        });
    </script>
</body>
</html>